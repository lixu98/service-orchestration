"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[9674,8764],{69674:function(e,t,i){i.r(t),i.d(t,{DW_ORGTREE_MODAL_DEFAULT:function(){return d},DwOrganizeTreeCoreModule:function(){return l},DwOrganizeTreeService:function(){return o}});var r=i(42746),n=i(71049),s=i(55245);const d=new r.InjectionToken("dwSystemConfig.dwOrgTreeModalDefault",{providedIn:"root",factory:()=>({})});let l=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=r.\u0275\u0275defineInjector({imports:[[s.CommonModule]]}),e})(),o=(()=>{class e{constructor(e){this.openOrgTreeModalDefault=e,this._cache={},this._fullNodesRoot=[{type:"org",id:"A00001",sid:100001,title:"\u9f0e\u6377\uff08\u5357\u4eac\uff09",children:[{type:"org",id:"AA0001",title:"\u670d\u52d9\u90e8",sid:100002},{type:"org",id:"AB0001",title:"\u958b\u767c\u90e8",sid:100003,children:[{type:"org",id:"ABA001",title:"\u958b\u767c\u7d44",sid:100011,children:[{type:"user",id:"ABA001",title:"\u6c88\u6d77",sid:100001},{type:"user",id:"ABA002",title:"\u6c5f\u6cb3",sid:100006}]},{type:"org",id:"ABA002",title:"\u6e2c\u8a66\u7d44",sid:100012,children:[{type:"user",key:"ABA005",title:"\u6e56\u6708",sid:100007}]},{type:"user",id:"ABA003",title:"\u6c6a\u6d0b",sid:100005}]},{type:"org",id:"AC0002",title:"\u61c9\u7528\u90e8",sid:100004,children:[{type:"user",id:"AC0001",title:"\u674e\u5fd7\u6c5f",sid:100002},{type:"user",id:"AC0002",title:"\u674e\u658c",sid:100003},{type:"user",id:"AC0003",title:"\u738b\u6b23",sid:100004}]}]}],this._fullNodes=[{type:"org",id:"AA0001",title:"\u670d\u52d9\u90e8",sid:100002},{type:"org",id:"AB0001",title:"\u958b\u767c\u90e8",sid:100003,children:[{type:"org",id:"ABA001",title:"\u958b\u767c\u7d44",sid:100011,children:[{type:"user",id:"ABA001",title:"\u6c88\u6d77",sid:100001},{type:"user",id:"ABA002",title:"\u6c5f\u6cb3",sid:100006}]},{type:"org",id:"ABA002",title:"\u6e2c\u8a66\u7d44",sid:100012,children:[{type:"user",id:"ABA005",title:"\u6e56\u6708",sid:100007}]},{type:"user",id:"ABA003",title:"\u6c6a\u6d0b",sid:100005}]},{type:"org",id:"AC0002",title:"\u61c9\u7528\u90e8",sid:100004,children:[{type:"user",id:"AC0001",title:"\u674e\u5fd7\u6c5f",sid:100002},{type:"user",id:"AC0002",title:"\u674e\u658c",sid:100003},{type:"user",id:"AC0003",title:"\u738b\u6b23",sid:100004}]}],this._orgNodes=[{type:"org",id:"A00001",sid:100001,title:"\u9f0e\u6377\uff08\u5357\u4eac\uff09",children:[{type:"org",id:"AA0001",title:"\u670d\u52d9\u90e8",sid:100002},{type:"org",id:"AB0001",title:"\u958b\u767c\u90e8",sid:100003,children:[{type:"org",id:"ABA001",title:"\u958b\u767c\u7d44",sid:100011,children:[]},{type:"org",id:"ABA002",title:"\u6e2c\u8a66\u7d44",sid:100012}]},{type:"org",id:"AC0002",title:"\u61c9\u7528\u90e8",sid:100004,children:[]}]}],this.sortFn=(e,t,i)=>e.type===i&&t.type!==i?-1:e.type!==i&&t.type===i?1:0}getVirtualRootnode(){return Object.assign({},{type:"root",key:null,title:null,sid:null,parentKey:null,parentTitle:null,parentSid:null,children:[]})}initTreeDatas(e,t){const i=JSON.parse(JSON.stringify(t)),r=this.getVirtualRootnode();return r.children.push(...i),r.children.sort((t,i)=>this.sortFn(t,i,e.sortType)),r.children.forEach(t=>{this.initNode(e,t,r)}),r.children}initNode(e,t,i){if(Object.assign(t,{sid:t.sid.toString(),key:this.initNodeKey(e,t,i),parentKey:i.key,parentTitle:i.title,parentSid:i.sid?i.sid.toString():i.sid,expanded:t.hasOwnProperty("expanded")?t.expanded:e.expandAll,isLeaf:!1}),"org"===t.type&&"full"===e.dataType&&"user"===e.selectType&&Object.assign(t,{disabled:!0}),"org"===t.type&&(!t.hasOwnProperty("children")||0===t.children.length)&&Object.assign(t,{expanded:!1,isLeaf:!0}),"user"===t.type&&Object.assign(t,{expanded:!1,icon:"user",isLeaf:!0}),t.hasOwnProperty("children")&&t.children.length>0){t.children.sort((t,i)=>this.sortFn(t,i,e.sortType));for(let i=0;i<t.children.length;i++)this.initNode(e,t.children[i],t)}}initNodeKey(e,t,i){return t.type+("org"===t.type?t.sid:i.sid)+"-"+("id"===e.keyType?t.id:t.sid)}setCache(e,t){const i=this.getTreeDataMode(e),r=this.initTreeDatas(i,t),n=this.getCacheKeys(i);this._cache[n]=r}getCache(e){const t=this.getTreeDataMode(e),i=this.getCacheKeys(t);return this._cache[i]?this._cache[i]:[]}getOrganizeTree(e){return new n.Observable(t=>{const i=this.getCache(e);if(i.length>0)return t.next(i),void t.complete();this.setCache(e,"full"===e.dataType?this._fullNodes:this._orgNodes),t.next(this.getCache(e)),t.complete()})}getCombinedKey(e,t=!1){let i=e.key,r=e.type,n="org"===r?e.sid:e.parentSid;return t&&(i=e.parentKey,n=e.parentSid,r="org"),i&&r+n+"-"+i}replaceKey(e){return e&&e.split("-")[1]}getKeys(e){const t=[];return 0===e.length||e.forEach(e=>{t.push(this.getCombinedKey(e))}),t}getTreeDataMode(e){return Object.assign({},{dataType:this.openOrgTreeModalDefault.treeDataType,keyType:this.openOrgTreeModalDefault.treeKeyType,selectType:this.openOrgTreeModalDefault.treeSelectType,expandAll:this.openOrgTreeModalDefault.treeExpandAll},e)}getNodeLists(e,t={}){const i=this.getTreeDataMode(t);return new n.Observable(t=>{if(!e||0===e.length)return t.next([]),void t.complete();this.getOrganizeTree(i).subscribe(i=>{const r=this.getMatchNodes(e,i);t.next(this.convertToList(r)),t.complete()})})}getMatchNodes(e,t){const i=[],r=[],n=JSON.parse(JSON.stringify(t)),s=this.getKeys(e);for(i.push(...n);0!==i.length;){const e=i.pop();if(s.indexOf(e.key)>=0&&r.push(e),e.hasOwnProperty("children")&&e.children.length>0)for(let t=e.children.length-1;t>=0;t--)i.push(e.children[t])}return r}convertToList(e){const t=[],i=[];for(t.push(...e);0!==t.length;){const e=t.pop();if(i.push(this.getNodeOriginValue(e)),e.hasOwnProperty("children")&&e.children.length>0)for(let i=e.children.length-1;i>=0;i--)t.push(e.children[i])}return i}convertedTotree(e){const t=JSON.parse(JSON.stringify(e));t.forEach(e=>{Object.assign(e,{key:this.getCombinedKey(e),parentKey:this.getCombinedKey(e,!0)})});const i=[],r=[];for(let n=0;n<t.length;n++)i[t[n].key]=n,"org"===t[n].type&&(t[n].children=[]);for(let n=0;n<t.length;n++){const e=t[n];e.parentKey&&void 0!==i[e.parentKey]&&e.parentKey!==e.key?t[i[e.parentKey]].children.push(e):r.push(e)}return this.convertedtreeDatas(r)}convertedtreeDatas(e){const t=this.getVirtualRootnode();return t.children.push(...e),t.children.forEach(e=>{this.convertedtreeNode(e)}),t.children}convertedtreeNode(e){if(Object.assign(e,{key:this.replaceKey(e.key),parentKey:this.replaceKey(e.parentKey)}),e.hasOwnProperty("children")&&e.children.length>0)for(let t=0;t<e.children.length;t++)this.convertedtreeNode(e.children[t])}getNodeOriginValue(e){return Object.assign({},{type:e.type,key:this.replaceKey(e.key),title:e.title,id:e.id,sid:e.sid,parentKey:this.replaceKey(e.parentKey),parentTitle:e.parentTitle,parentSid:e.parentSid})}resetCache(){this._cache={}}reloadCache(e){return this.resetCache(),this._fullNodes=this._fullNodesRoot,this.getOrganizeTree(e)}getCacheKeys(e){return e.dataType+"-"+e.keyType+"-"+e.selectType+"-"+e.expandAll.toString()}setExpandTreeNodes(e,t){const i=[];for(i.push(...e);0!==i.length;){const e=i.pop();if(+e.level<=+t&&(e.isExpanded=!0),e.hasOwnProperty("children")&&e.children.length>0)for(let t=e.children.length-1;t>=0;t--)i.push(e.children[t])}}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275inject(d))},e.\u0275prov=r.\u0275\u0275defineInjectable({factory:function(){return new e(r.\u0275\u0275inject(d))},token:e,providedIn:l}),e})()}}]);