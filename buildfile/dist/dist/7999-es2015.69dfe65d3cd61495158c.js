"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[7999],{4186:function(e,t,i){i.r(t),i.d(t,{DW_AUTH_TOKEN:function(){return p},DW_AUTH_TOKEN_FACTORY:function(){return v},DwActionAuthorizedService:function(){return b},DwAuthFunctionPermissionRepository:function(){return l},DwAuthGuardService:function(){return w},DwAuthModule:function(){return d},DwAuthPermissionInfoService:function(){return f},DwAuthService:function(){return S},DwAuthorizedService:function(){return g}});var n=i(42746),r=i(71049),s=i(20033),o=i(55245),c=i(47372),u=i(66800),a=i(87974),h=i(30469);let d=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=n.\u0275\u0275defineInjector({imports:[[o.CommonModule]]}),e})(),l=(()=>{class e{constructor(e){this.dwOperationInfoListService=e}getFunctionPermissionAll(){return r.Observable.create(e=>{this.dwOperationInfoListService.operationListMap$.subscribe(t=>{const i={data:[]};Object.keys(t).forEach(e=>{const n=t[e],r={code:e,page:[],action:[]};n.hasOwnProperty("page")&&n.page.forEach(e=>{r.page.push({id:e.id,restriction:"allow"})}),n.hasOwnProperty("action")&&n.action.forEach(e=>{r.action.push({id:e.id,restriction:"allow"})}),i.data.push(r)}),e.next(i),e.complete()})})}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(s.DwOperationInfoListService))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(s.DwOperationInfoListService))},token:e,providedIn:d}),e})(),f=(()=>{class e{constructor(e,t){this.dwTenantService=e,this.dwAuthFunctionPermissionRepository=t,this.isPermissionInit=!1,this.authorizedList=null,this.authorizedListSubject=new r.BehaviorSubject(this.authorizedList),this.dwTenantService.isTokenValid$.subscribe(e=>{e?this.isPermissionInit||(this.isPermissionInit=!0,this.authorizedList={},this.dwAuthFunctionPermissionRepository.getFunctionPermissionAll().subscribe(e=>{const t=e.data;t.push({code:"home",page:[],action:[]}),t.forEach(e=>{e.hasOwnProperty("action")&&e.action.forEach(e=>{""===e&&(e="disabled")});const t={programId:e.code,action:e.action?e.action:[]};if(this.authorizedList[e.code]=t,e.hasOwnProperty("page")){const i=e.page.length;for(let n=0;n<i;n++)if("allow"===e.page[n].restriction){this.authorizedList[e.page[n].id]={programId:t.programId,action:[]}}}}),this.authorizedListSubject.next(this.authorizedList)},e=>{console.log(e),this.authorizedList=void 0,this.authorizedListSubject.next(this.authorizedList)})):this.clearPermissTree()},e=>{console.log(e),this.clearPermissTree()})}get authorizedList$(){return this.authorizedListSubject.asObservable().pipe((0,c.filter)(e=>null!==e),(0,c.distinctUntilChanged)())}clearPermissTree(){this.isPermissionInit=!1,this.authorizedList=null,this.authorizedListSubject.next(this.authorizedList)}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(u.DwTenantService),n.\u0275\u0275inject(l))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(u.DwTenantService),n.\u0275\u0275inject(l))},token:e,providedIn:d}),e})(),g=(()=>{class e{constructor(){}canLoad(e){return!0}canActivate(e){return!0}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:d}),e})();function v(){return{}}const p=new n.InjectionToken("DW_AUTH_TOKEN",{providedIn:d,factory:v});let S=(()=>{class e{constructor(e,t,i,n,s){this.router=e,this.userService=t,this.authToken=i,this.defaultLogin=n,this.dwTenantService=s,this.loginSuccess="boolean"==typeof this.userService.getUser("isLoggedin")?this.userService.getUser("isLoggedin"):null,this.loginSubject=new r.BehaviorSubject(this.loginSuccess),this.setAuthToken({})}get isLoggedIn$(){return this.loginSubject.asObservable().pipe((0,c.filter)(e=>null!==e),(0,c.distinctUntilChanged)())}get isLoggedIn(){return this.loginSuccess}isAuthenticated(e){const t=e.url,i="boolean"==typeof this.userService.getUser("isLoggedin")?this.userService.getUser("isLoggedin"):null;return i||this.router.navigate([this.defaultLogin],{queryParams:{returnUrl:t}}),i}login(e){const t={success:!0,description:"",currTenantList:[]};return new r.Observable(i=>{this.setLogined({userId:e.userId,userName:e.userId,token:""}),this.dwTenantService.setTokenValid(!0),i.next(t),i.complete()})}logout(e=!0){void 0!==this.userService.getUser("token")?(this.loginSuccess=!1,this.loginSubject.next(this.loginSuccess),this.userService.clearUser(),this.authToken.token="",!0===e&&this.router.navigateByUrl(this.defaultLogin)):this.router.navigateByUrl(this.defaultLogin)}setAuthToken(e){Object.keys(e).length>0&&this.userService.setUserInfo(e),this.authToken.token=this.userService.getUser("token")?this.userService.getUser("token"):""}setLogined(e){this.userService.setUserInfo({isLoggedin:!0}),this.setAuthToken(e),this.loginSuccess=!0,this.loginSubject.next(this.loginSuccess)}tokenRefreshTenant(e){return console.error("\u8acb\u6ce8\u610f\uff1aDwTenantService.tokenRefreshTenant() \u53d6\u4ee3 DwAuthService.tokenRefreshTenant()"),new r.Observable(e=>{e.next({}),e.complete()})}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(a.Router),n.\u0275\u0275inject(u.DwUserService),n.\u0275\u0275inject(p),n.\u0275\u0275inject(h.LONIG_DEFAULT),n.\u0275\u0275inject(u.DwTenantService))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(a.Router),n.\u0275\u0275inject(u.DwUserService),n.\u0275\u0275inject(p),n.\u0275\u0275inject(h.LONIG_DEFAULT),n.\u0275\u0275inject(u.DwTenantService))},token:e,providedIn:d}),e})(),w=(()=>{class e{constructor(e,t){this.authService=e,this.authorizedService=t}canLoad(e){return this.authorizedService.canLoad(e.path)}canActivateChild(e,t){return this.auth(e,t)}canActivate(e,t){return this.auth(e,t)}auth(e,t){return!!this.authService.isAuthenticated(t)&&this.authorizedService.canActivate(e)}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(S),n.\u0275\u0275inject(g))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(S),n.\u0275\u0275inject(g))},token:e,providedIn:d}),e})(),b=(()=>{class e{constructor(e){this.authPermissionInfoService=e}getActionAuth(e,t){return r.Observable.create(i=>{let n=null;this.authPermissionInfoService.authorizedList$.pipe().subscribe(r=>{const s=r,o=s[e];if(o){let i=[];if(o.programId===e)i=o.action;else{const e=s[o.programId];e&&(i=e.action)}i=i.filter(e=>e.id===t),1===i.length?i[0].hasOwnProperty("id")&&i[0].hasOwnProperty("restriction")&&(n=i[0].restriction):s[t]&&(n="allow")}i.next(n),i.complete()},n=>{i.complete(),console.log(e+"("+t+"):"),console.log(n)})})}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(f))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(f))},token:e,providedIn:d}),e})()}}]);