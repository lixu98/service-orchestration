"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[3723],{26654:function(e,t,r){r.r(t),r.d(t,{DwFinereportConfigService:function(){return h},DwFinereportCoreModule:function(){return g},DwFinereportLangLoaderService:function(){return d},DwFinereportRepository:function(){return v},DwIframeFinereportInfoService:function(){return j},DwIframeFinereportService:function(){return w}});var n=r(42746),i=r(71049),c=r(47372),o=r(51156),s=r(30469),a=r(55245),u=r(83522),f=r(32245),p=r(32276),l=r(66800);let g=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=n.\u0275\u0275defineInjector({imports:[[a.CommonModule]]}),e})(),h=(()=>{class e{constructor(e){this.configService=e,this.configService.get("frUrl").subscribe(e=>this.frUrl=e)}frEnable(){let e=!1;return this.frUrl&&""!==this.frUrl&&"@FINEREPORT_URL@"!==this.frUrl&&(e=!0),e}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(s.DwSystemConfigService))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(s.DwSystemConfigService))},token:e,providedIn:g}),e})(),v=(()=>{class e{constructor(e,t){this.http=e,this.dwFinereportConfigService=t}getReport(e){return this.dwFinereportConfigService.frEnable()?this.http.get("restful/service/DWSys/report",{params:{code:e}}):(0,i.of)({success:!0,data:null})}language(e){return this.dwFinereportConfigService.frEnable()?this.http.get("restful/service/DWSys/report/list/language",{params:{language:e}}).pipe((0,c.map)(e=>{const t={};return e.data.forEach(e=>{""!==e.name&&(t[e.code]=e.name)}),t})):(0,i.of)({})}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(o.DwDapHttpClient),n.\u0275\u0275inject(h))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(o.DwDapHttpClient),n.\u0275\u0275inject(h))},token:e,providedIn:g}),e})(),d=(()=>{class e{constructor(e,t){this.injector=e,this.translateService=t}init(){const e=this.injector.get(f.DwLanguageService).currentLanguage;this.getTranslation(e).subscribe(t=>{this.translateService.setTranslation(e,t,!0)},e=>{console.log(e)})}getTranslation(e){return this.injector.get(p.DwAuthService).isLoggedIn?this.injector.get(v).language(e).pipe((0,c.map)(e=>({prog:e}))):(0,i.of)({})}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(n.Injector),n.\u0275\u0275inject(u.TranslateService))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(n.INJECTOR),n.\u0275\u0275inject(u.TranslateService))},token:e,providedIn:g}),e})(),w=(()=>{class e{constructor(){}getIframeFinereportData(e,t,r){return this.itemRxjsBehavior=new i.BehaviorSubject(null),this.itemRxjsBehavior.next(r),this.itemRxjsBehavior.asObservable().pipe((0,c.filter)(e=>null!==e),(0,c.distinctUntilChanged)())}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e})(),j=(()=>{class e{constructor(e,t,r,n,i,c,o){this.sysReportRepository=e,this.dwLanguageService=t,this.dwIframeFinereportService=r,this.dwAppId=n,this.usingTab=i,this.configService=c,this.userService=o,this.configService.get("frUrl").subscribe(e=>this.frUrl=e)}finereportInfo(e,t){const r={};Object.keys(t).forEach(e=>{"dwMenuId"!==e&&(r[e]=t[e])});const n={url:"",type:"fineReport"};let i=e;const o=this.dwLanguageService.currentLanguage;return this.sysReportRepository.getReport(e).pipe((0,c.map)(e=>{const t={},n=e.data;if(Object.keys(r).forEach(e=>{t[e]=r[e]}),n){const e=n.fixparam?n.fixparam:[];t.viewlet=(n.from?n.from:"")+"/"+this.dwAppId+"/"+o+"/"+(n.name?n.name:""),i=n.code,e.forEach(e=>{t[e.name]=e.value})}return t.token=this.userService.getUser("token"),t}),(0,c.switchMap)(r=>{n.url=this.frUrl+"/digiwin/kanban/view/form";let i=0;return Object.keys(r).forEach(e=>{let t="&";0===i&&(t="?");let c=r[e].toString();c=c.replace("{{lang_code}}",o),n.url=n.url+t+e+"="+c,i+=1}),this.dwIframeFinereportService.getIframeFinereportData(e,t,n)}),(0,c.first)())}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275inject(v),n.\u0275\u0275inject(f.DwLanguageService),n.\u0275\u0275inject(w),n.\u0275\u0275inject(s.DW_APP_ID),n.\u0275\u0275inject(s.DW_USING_TAB),n.\u0275\u0275inject(s.DwSystemConfigService),n.\u0275\u0275inject(l.DwUserService))},e.\u0275prov=n.\u0275\u0275defineInjectable({factory:function(){return new e(n.\u0275\u0275inject(v),n.\u0275\u0275inject(f.DwLanguageService),n.\u0275\u0275inject(w),n.\u0275\u0275inject(s.DW_APP_ID),n.\u0275\u0275inject(s.DW_USING_TAB),n.\u0275\u0275inject(s.DwSystemConfigService),n.\u0275\u0275inject(l.DwUserService))},token:e,providedIn:g}),e})()}}]);