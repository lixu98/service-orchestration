"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[1162],{31868:function(e,r,t){t.r(r),t.d(r,{DwHttpApiInterceptor:function(){return I},DwHttpClient:function(){return b},DwHttpClientOptionsService:function(){return p},DwHttpErrorHandlerService:function(){return M},DwHttpLoadMaskService:function(){return f},DwHttpMessageLoginService:function(){return v},DwHttpMessageService:function(){return w},DwHttpModule:function(){return l},DwHttpRequestUrlService:function(){return g},DwSystemHttpErrorHandler:function(){return S}});var s=t(42746),o=t(55245),n=t(71049),i=t(83522),c=t(99487),a=t(32276),u=t(78597),d=t(30469),h=t(47372);let l=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=s.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=s.\u0275\u0275defineInjector({imports:[[o.CommonModule]]}),e})(),p=(()=>{class e{constructor(){}setLoadMaskCfg(e,r,t,s){return null}getUiOptions(e){return null}getLoadingMaskCfg(e){return null}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:l}),e})(),g=(()=>{class e{constructor(){}getUrl(e,r){let t=e;return r.startsWith("http://")||r.startsWith("https://")||r.startsWith("//")||r.startsWith("assets/")?t=r:r&&(t=e+"/"+r),t}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:l}),e})(),w=(()=>{class e{constructor(){}error(e,r){let t="",s="";return e?"string"==typeof e&&(s=e):r&&(r.hasOwnProperty("dwTitle")&&(t=r.dwTitle+"\n"),r.hasOwnProperty("dwContent")&&r.dwContent&&"string"==typeof r.dwContent&&(s=t+r.dwContent)),new n.Observable(e=>{s&&alert(s),e.next(!0),e.complete()})}warning(e,r){const t=this.getMessage(e);return new n.Observable(e=>{alert(t),e.next(!0),e.complete()})}confirm(e){const r=this.getMessage(e);return new n.Observable(e=>{confirm(r)?(e.next(!0),e.complete()):(e.next(!1),e.complete())})}create(e,r,t){let s=null;return"string"==typeof e&&(s=this.getMessage(r)),"object"==typeof e&&(s=this.getMessage(e)),new n.Observable(e=>{confirm(s)?(e.next(!0),e.complete()):(e.next(!1),e.complete())})}getMessage(e){const r=[];let t="error";return"string"==typeof e&&(t=e),"object"==typeof e&&(e.hasOwnProperty("dwTitle")&&r.push(e.dwTitle),e.hasOwnProperty("dwContent")&&r.push(e.dwContent),r.length>0&&(t=r.join("\n"))),t}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:l}),e})(),f=(()=>{class e{constructor(){}showMask(e){}hideMask(e){}clear(){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:l}),e})(),M=(()=>{class e{constructor(e,r,t,s,o,n,i){this.injector=e,this.dwLoggingService=r,this.dwMessageService=t,this.configService=s,this.translateService=o,this.dwHttpLoadMaskService=n,this.dwAppId=i,this.dwMultiTenant=!1,this.singleMsgShowing=!1,this.configService.get("multiTenant").subscribe(e=>this.dwMultiTenant=e),this.configService.get("consoleUrl").subscribe(e=>this.consoleUrl=e),this.configService.get("marketUrl").subscribe(e=>this.marketUrl=e)}handle(e){if(e instanceof c.HttpErrorResponse){if(0===e.status)this.dwLoggingService.httpError(e);else if(e.error){const r=this.injector.get(a.DwAuthService),t=this.instructorToArray(e,[]);e.error.dwInstructorList=t;let s=!1;const o=t.length;for(let e=0;e<o;e++){const o=this.errorRule(t[e].sourceId,t[e].errorCode);if(o)if(o.handlerProcess){if(s=this.handlerProcess(t[e]),s)break}else{if(o.logout){s=!0,this.showMessageLogout(t[e].errorMessage,t[e].url,r);break}if(!o.logout){s=!0,this.showMessage(t[e].errorMessage,t[e].url);break}}else if("IAM"===t[e].sourceId&&401===t[e].status){s=!0,this.showMessageLogout(t[e].errorMessage,t[e].url,r);break}}if(!s&&o>0){const e=o-1;if(t[e].sourceId&&"10903"===t[e].errorCode||"10904"===t[e].errorCode){const o=t[0];o.hasOwnProperty("response")&&o.response.hasOwnProperty("message")&&(s=!0,!1===this.singleMsgShowing&&(this.singleMsgShowing=!0,this.dwMessageService.error(o.response.message).subscribe(s=>{this.singleMsgShowing=!1,"10904"===t[e].errorCode&&r.logout()})))}}s&&e.error.hasOwnProperty("errorMessage")&&(e.error.errorMessage="")}}else console.error(e)}showMessageLogout(e,r,t){if(e&&-1===r.indexOf("/logout")){if(!1===this.singleMsgShowing){this.singleMsgShowing=!0;const r={dwContent:e};this.dwHttpLoadMaskService.clear(),this.dwMessageService.error(null,r).subscribe(e=>{this.singleMsgShowing=!1,t.logout()})}}else t.logout()}showMessage(e,r){e&&!1===this.singleMsgShowing&&(this.singleMsgShowing=!0,this.dwMessageService.error(null,{dwContent:e+"<br>"+r}).subscribe(e=>{this.singleMsgShowing=!1}))}instructorToArray(e,r){const t={status:null,url:"",sourceId:"",errorCode:"",errorMessage:"",response:{}};let s={};return e.hasOwnProperty("sourceAPI")?(t.status=e.sourceAPI.status,t.url=e.sourceAPI.url,t.sourceId=e.sourceAPI.response.sourceId,t.errorCode=e.sourceAPI.response.errorCode,t.errorMessage=e.sourceAPI.response.errorMessage,t.response=e.sourceAPI.response,e.sourceAPI.response.hasOwnProperty("errorInstructors")&&(s=e.sourceAPI.response.errorInstructors)):(t.status=e.status,t.url=e.url,e.hasOwnProperty("error")&&(t.sourceId=e.error.sourceId,t.errorCode=e.error.errorCode,t.errorMessage=e.error.errorMessage,t.response=e.error.response,e.error.hasOwnProperty("errorInstructors")&&(s=e.error.errorInstructors))),s&&s.hasOwnProperty("sourceAPI")&&this.instructorToArray(s,r),r.push(t),r}messageAddConfirm(e,r){let t="";const s=e.length,o=this.translateService.currentLang;return t=e.indexOf("\u3002")===s-1||e.indexOf(".")===s-1?"zh_TW"===o||"zh_CN"===o?e+r:e+" "+r:"zh_TW"===o||"zh_CN"===o?e+"\u3002"+r:e+". "+r,t}handlerProcess(e){let r=!1;return"21006"===e.errorCode?(r=!0,this.dwMultiTenant&&this.marketUrl&&"@MARKET_URL@"!==this.marketUrl?this.dwMessageService.confirm({dwTitle:"",dwContent:this.messageAddConfirm(e.errorMessage,this.translateService.instant("dw-login-confirm-iam-21006"))}).subscribe(e=>{e&&window.open(this.marketUrl+"/product-details?goodsCode="+this.dwAppId)}):this.showMessage(e.errorMessage,"")):"21008"===e.errorCode&&(r=!0,this.dwMultiTenant&&this.consoleUrl&&"@CONSOLE_URL@"!==this.consoleUrl?this.dwMessageService.confirm({dwTitle:"",dwContent:this.messageAddConfirm(e.errorMessage,this.translateService.instant("dw-login-confirm-iam-21008"))}).subscribe(e=>{e&&window.open(`${this.consoleUrl}`)}):this.showMessage(e.errorMessage,"")),r}errorRule(e,r){const t=[{sourceId:"IAM",errorCode:"20004",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"20005",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"20404",handlerProcess:!1,logout:!1},{sourceId:"IAM",errorCode:"21006",handlerProcess:!0,logout:!1},{sourceId:"IAM",errorCode:"21007",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"21008",handlerProcess:!0,logout:!1},{sourceId:"IAM",errorCode:"21009",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"21017",handlerProcess:!1,logout:!0}];let s=null;const o=t.length;for(let n=0;n<o;n++)if(t[n].sourceId===e&&t[n].errorCode===r){s=t[n];break}return s}}return e.\u0275fac=function(r){return new(r||e)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(u.DwLoggingService),s.\u0275\u0275inject(w),s.\u0275\u0275inject(d.DwSystemConfigService),s.\u0275\u0275inject(i.TranslateService),s.\u0275\u0275inject(f),s.\u0275\u0275inject(d.DW_APP_ID))},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e(s.\u0275\u0275inject(s.INJECTOR),s.\u0275\u0275inject(u.DwLoggingService),s.\u0275\u0275inject(w),s.\u0275\u0275inject(d.DwSystemConfigService),s.\u0275\u0275inject(i.TranslateService),s.\u0275\u0275inject(f),s.\u0275\u0275inject(d.DW_APP_ID))},token:e,providedIn:l}),e})(),v=(()=>{class e{constructor(e){this.httpMessageService=e}showWarning(e){return this.httpMessageService.warning(e.description)}}return e.\u0275fac=function(r){return new(r||e)(s.\u0275\u0275inject(w))},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e(s.\u0275\u0275inject(w))},token:e,providedIn:l}),e})(),I=(()=>{class e{constructor(e){this.configService=e,this.configService.get("apiUrl").subscribe(e=>this.apiUrl=e)}intercept(e,r){const t=e.url,s=t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")||t.startsWith("assets/");return s||(e=e.clone({url:this.apiUrl+t})),r.handle(e).pipe((0,h.map)(e=>{if(e instanceof c.HttpResponse){const r=e;e=e.clone({body:s?r.body:r.body.response})}return e}))}}return e.\u0275fac=function(r){return new(r||e)(s.\u0275\u0275inject(d.DwSystemConfigService))},e.\u0275prov=s.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),S=(()=>{class e{handlerError(e){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=s.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:l}),e})(),b=(()=>{class e{constructor(e,r){this.dwHttpRequestUrlService=e,this.dwHttpLoadMaskService=r,this.api="",this.systemHttpError=(0,s.inject)(S),this.http=(0,s.inject)(c.HttpClient),this.dwLoggingService=(0,s.inject)(u.DwLoggingService)}errorHandler(e){}responseIntercept(e){return e}get defaultHeaders(){return{}}get defaultParams(){return{}}get httpCodec(){return new c.HttpUrlEncodingCodec}setThrowawayHeader(e){this.throwawayHeader=e}newHttpHeaders(){let e=new c.HttpHeaders;return Object.keys(this.defaultHeaders).forEach(r=>{e=e.set(r,this.defaultHeaders[r])}),e}addDefaultOption(e){const r=e||{};let t,s;if(t=r.headers instanceof c.HttpHeaders?r.headers:void 0!==r.headers?new c.HttpHeaders(r.headers):this.newHttpHeaders(),void 0!==this.throwawayHeader){const e=this.throwawayHeader;this.throwawayHeader=void 0,Object.keys(e).forEach(r=>{t=t.set(r,e[r])})}return r.params&&(s=r.params instanceof c.HttpParams?r.params:new c.HttpParams({fromObject:r.params,encoder:this.httpCodec})),s=Object.keys(this.defaultParams).reduce((e,r)=>e.has(r)?e:e.set(r,this.defaultParams[r]),s),{headers:t,observe:r.observe,params:s,body:r.body,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials}}requestProcess(e,r){const t=this.dwHttpLoadMaskService.showMask(r);return e.pipe((0,h.tap)(e=>(this.dwHttpLoadMaskService.hideMask(t),this.dwLoggingService.httpErrorCloseMessage(e),e),e=>{this.dwHttpLoadMaskService.hideMask(t),this.systemHttpError.handlerError(e),this.errorHandler(e)}),(0,h.map)(e=>this.responseIntercept(e)))}request(e,r,t){const s=this.addDefaultOption(t),o=this.dwHttpRequestUrlService.getUrl(this.api,r),n=this.http.request(e,o,s);return this.requestProcess(n,t)}get(e,r){const t=this.addDefaultOption(r),s=this.dwHttpRequestUrlService.getUrl(this.api,e),o=this.http.get(s,t);return this.requestProcess(o,r)}post(e,r,t){const s=this.addDefaultOption(t),o=this.dwHttpRequestUrlService.getUrl(this.api,e),n=this.http.post(o,r,s);return this.requestProcess(n,t)}put(e,r,t){const s=this.addDefaultOption(t),o=this.dwHttpRequestUrlService.getUrl(this.api,e),n=this.http.put(o,r,s);return this.requestProcess(n,t)}delete(e,r){const t=this.addDefaultOption(r),s=this.dwHttpRequestUrlService.getUrl(this.api,e),o=this.http.delete(s,t);return this.requestProcess(o,r)}}return e.\u0275fac=function(r){return new(r||e)(s.\u0275\u0275inject(g),s.\u0275\u0275inject(f))},e.\u0275prov=s.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})()}}]);