"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[9133],{27848:function(e,t,n){n.r(t),n.d(t,{DW_ROUTER_KEY_COOKIE_DOMAIN:function(){return E},DW_ROUTER_KEY_COOKIE_PATH:function(){return y},DW_ROUTER_KEY_HEADER_IGNORE_APIS:function(){return v},DW_ROUTER_KEY_REFRESH_PAGE:function(){return m},DwRouterKeyConfuseModalComponent:function(){return b},DwRouterKeyConfuseModalResult:function(){return k},DwRouterKeyConfuseModalService:function(){return K},DwRouterKeyConfuseWarnBarComponent:function(){return I},DwRouterKeyHttpHeaderInterceptor:function(){return _},DwRouterKeyModule:function(){return j},DwRouterKeyService:function(){return R},deleteRouterKey:function(){return S},getRouterKey:function(){return w},setRouterKey:function(){return C},"\u0275a":function(){return O}});var r=n(42746),o=n(66800),i=n(32276),s=n(87974),c=n(99487),a=n(83522),u=n(16612),l=n(30469),h=n(51855),d=n(71049),p=n(10952),f=n(47372),g=n(78597);const m=new r.InjectionToken("DW_ROUTER_KEY_REFRESH_PAGE"),y=new r.InjectionToken("DW_ROUTER_KEY_COOKIE_PATH"),E=new r.InjectionToken("DW_ROUTER_KEY_COOKIE_DOMAIN"),v=new r.InjectionToken("DW_ROUTER_KEY_HEADER_IGNORE");var k=(()=>{return(e=k||(k={})).REFRESH="refresh",e.CONTINUE="continue",e.CLOSE="close",k;var e})();function w(){const e=document.cookie.split(";").find(e=>e.trim().startsWith("routerKey="));return e?e.split("=").pop():void 0}function C(e,t="/",n=null){const r=n?` domain=${n};`:"";document.cookie=`routerKey=${e}; expires=; path=${t};`+r,document.cookie=`routerKey=${e}; path=${t};`+r}function S(e="/",t=null){document.cookie=`routerKey=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${e};`+(t?` domain=${t};`:"")}let R=(()=>{class e{constructor(e,t,n,r,o,i,s){this.authService=e,this.userService=t,this.tenantService=n,this.refresh=r,this.cookiePath=o,this.cookieDomain=i,this.route=s,this.tenantService.isTokenValid$.subscribe(e=>{if(e){const e=t.getUser("tenantId");w()!==e&&(C(t.getUser("tenantId"),this.cookiePath,this.cookieDomain),this.reloadPage())}else w()&&(S(this.cookiePath,this.cookieDomain),this.reloadPage())})}reloadPage(){var e;const t=null===(e=this.route.snapshot)||void 0===e?void 0:e.queryParams,n=(null==t?void 0:t.routerLink)||(null==t?void 0:t.returnUrl)||"/";window.location.href=n.startsWith("/")?n:"/"+n}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275inject(i.DwAuthService),r.\u0275\u0275inject(o.DwUserService),r.\u0275\u0275inject(o.DwTenantService),r.\u0275\u0275inject(m),r.\u0275\u0275inject(y),r.\u0275\u0275inject(E),r.\u0275\u0275inject(s.ActivatedRoute))},e.\u0275prov=r.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),b=(()=>{class e{constructor(e){this.swUpdater=e,this.afterClose=new d.Subject}ngOnInit(){this.swUpdater&&this.swUpdater.stop()}continue(){this.afterClose.next(k.CONTINUE),this.afterClose.complete()}refresh(){this.afterClose.next(k.REFRESH),this.afterClose.complete()}close(){this.afterClose.next(k.CLOSE),this.afterClose.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275directiveInject(h.DwServiceWorkerUpdateService,8))},e.\u0275cmp=r.\u0275\u0275defineComponent({type:e,selectors:[["dw-router-key-confuse-modal"]],decls:14,vars:6,consts:[[1,"router-key-modal"],[1,"title"],[2,"font-size","24px","color","red"],["viewBox","64 64 896 896","focusable","false","fill","currentColor","width","1em","height","1em","data-icon","exclamation-circle","aria-hidden","true"],["d","M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512\n             64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"],["d","M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4\n              0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"],[1,"body"],[1,"footer"],[3,"click"]],template:function(e,t){1&e&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275elementStart(1,"div",1),r.\u0275\u0275elementStart(2,"i",2),r.\u0275\u0275namespaceSVG(),r.\u0275\u0275elementStart(3,"svg",3),r.\u0275\u0275element(4,"path",4),r.\u0275\u0275element(5,"path",5),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275namespaceHTML(),r.\u0275\u0275elementStart(6,"div",6),r.\u0275\u0275elementStart(7,"h3"),r.\u0275\u0275text(8),r.\u0275\u0275pipe(9,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(10,"div",7),r.\u0275\u0275elementStart(11,"button",8),r.\u0275\u0275listener("click",function(){return t.continue()}),r.\u0275\u0275text(12),r.\u0275\u0275pipe(13,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd()),2&e&&(r.\u0275\u0275advance(8),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(9,2,"dw-router-key-confuse-message")),r.\u0275\u0275advance(4),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(13,4,"dw-router-key-confuse-continue")))},pipes:[a.TranslatePipe],styles:["\n    .router-key-modal-backdrop {\n      background: #000;\n      opacity: 0.65 !important;\n    }\n    .router-key-modal {\n      width: 500px;\n      background-color: white;\n      border-radius: 5px;\n    }\n    .router-key-modal .body,\n    .router-key-modal .footer{\n      padding: 10px;\n    }\n    .router-key-modal .title {\n        padding: 5px 10px;\n    }\n    .router-key-modal .body {\n      border-top: 1px solid #eee;\n      border-bottom: 1px solid #eee;\n    }\n    .router-key-modal .body h3 {\n      line-height: 2em;\n    }\n    .router-key-modal .footer {\n      text-align: right;\n    }\n    .router-key-modal .footer button {\n      height: 2.5em;\n      cursor: pointer;\n      color: white;\n      background: red;\n      border: none;\n      border-radius: 3px;\n    }\n    .router-key-overlay-container {\n      height: 100%;\n      z-index: 3000 !important;\n      display: flex;\n      position: absolute;\n      width: 100%;\n    }\n  "],encapsulation:2}),e})(),I=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.\u0275\u0275defineComponent({type:e,selectors:[["ng-component"]],decls:4,vars:3,consts:[[1,"router-key-confuse-warn-bar"],[1,"message"]],template:function(e,t){1&e&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275elementStart(1,"span",1),r.\u0275\u0275text(2),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd()),2&e&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(3,1,"dw-router-key-confuse-message")))},pipes:[a.TranslatePipe],styles:["\n    .router-key-confuse-warn-bar {\n      text-align: center;\n    }\n    .router-key-confuse-warn-bar .message {\n      background-color: red;\n      padding: 0 10px;\n      color: white;\n    }\n  "],encapsulation:2}),e})(),K=(()=>{class e{constructor(e){this.overlay=e}open(){const e=new u.OverlayConfig({positionStrategy:this.overlay.position().global().centerHorizontally().centerVertically(),hasBackdrop:!0,backdropClass:"router-key-modal-backdrop"}),t=this.overlay.create(e);t.hostElement.className="router-key-overlay-container";const n=t.attach(new p.ComponentPortal(b));return n.instance.afterClose.subscribe(()=>{t.dispose()}),n.instance}showWarningBar(){this.overlay.create({width:"100%",panelClass:"router-key-warning-bar"}).attach(new p.ComponentPortal(I))}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275inject(u.Overlay))},e.\u0275prov=r.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),O=(()=>{class e{constructor(e,t,n){this.injector=e,this.routerKeyConfuseModal=t,this.loggingService=n,this.ignoreConfuse=!1,n&&(this.origHttpError=n.httpError,this.origRuntimeError=n.runtimeError,n.httpError=e=>{this.httpError(e)},n.runtimeError=e=>{this.runtimeError(e)})}httpError(e){this.checkRouterKey(),this.loggingService&&this.origHttpError&&this.origHttpError.call(this.loggingService,e)}runtimeError(e){this.checkRouterKey(),this.loggingService&&this.origRuntimeError&&this.origRuntimeError.call(this.loggingService,e)}checkRouterKey(){if(this.userInfo||(this.userInfo=this.injector.get(o.DwUserService)),this.ignoreConfuse)return;const e=this.userInfo.getUser("tenantId");w()!==e&&this.injector.get(r.NgZone).run(()=>{this.routerKeyConfuseModal.open().afterClose.subscribe(e=>{e===k.CONTINUE&&(this.ignoreConfuse=!0,this.routerKeyConfuseModal.showWarningBar())})})}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275inject(r.Injector),r.\u0275\u0275inject(K),r.\u0275\u0275inject(g.DwLoggingService,8))},e.\u0275prov=r.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),_=(()=>{class e{constructor(e,t,n,r,o,i,s){this.configService=e,this.userInfo=t,this.authService=n,this.routerKeyService=r,this.routerKeyConfuseModal=o,this.loggingService=i,this.ignoreApis=s,this.modalOpening=!1,this.ignoreConfuse=!1,this.isLogging=!1,this.configService.getConfig().subscribe(e=>this.config=e),this.authService.isLoggedIn$.subscribe(e=>{this.isLogging=e})}intercept(e,t){let n=!1;const r=this.userInfo.getUser("tenantId");return this.isLogging&&(n=w()!==r),this.includes(e.url)||r&&(e=e.clone({setHeaders:{routerKey:r}})),this.ignoreConfuse?t.handle(e):n&&!this.modalOpening?(this.modalOpening=!0,this.routerKeyConfuseModal.open().afterClose.pipe((0,f.tap)(e=>{switch(e){case k.REFRESH:this.authService.logout();break;case k.CONTINUE:this.ignoreConfuse=!0,this.routerKeyConfuseModal.showWarningBar();break;case k.CLOSE:window.close()}}),(0,f.takeWhile)(e=>e===k.CONTINUE),(0,f.concatMap)(()=>t.handle(e)))):t.handle(e)}includes(e){if(this.ignoreApis.length>0&&this.config)for(let t=0;t<this.ignoreApis.length;t++)if(e.startsWith(this.config[this.ignoreApis[t]]))return!0;return!1}}return e.\u0275fac=function(t){return new(t||e)(r.\u0275\u0275inject(l.DwSystemConfigService),r.\u0275\u0275inject(o.DwUserService),r.\u0275\u0275inject(i.DwAuthService),r.\u0275\u0275inject(R),r.\u0275\u0275inject(K),r.\u0275\u0275inject(O),r.\u0275\u0275inject(v,8))},e.\u0275prov=r.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),j=(()=>{class e{static forRoot(t=!0,n=[]){return{ngModule:e,providers:[O,R,K,{provide:y,useValue:"/"},{provide:E,useValue:null},{provide:m,useValue:t},{provide:c.HTTP_INTERCEPTORS,useClass:_,multi:!0},{provide:v,useValue:n}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=r.\u0275\u0275defineInjector({imports:[[a.TranslateModule,u.OverlayModule]]}),e})()}}]);