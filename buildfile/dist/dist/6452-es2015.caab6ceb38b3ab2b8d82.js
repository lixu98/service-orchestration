"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[6452],{90547:function(e,t,i){i.r(t),i.d(t,{ApiServerPagingService:function(){return H},DW_SELECT_MODAL_DEFAULT:function(){return U},DwClientPagingDataSource:function(){return K},DwSelectModalComponent:function(){return X},DwSelectModalCustomFilterPipe:function(){return Y},DwSelectModalModule:function(){return ee},DwSelectModalSearchPipe:function(){return G},DwSelectModalService:function(){return Z},DwServerPagingDataSource:function(){return J}});var n=i(53524),a=i(42746),s=i(47372),r=i(71049),o=i(83522),l=i(83237),d=i(31441),c=i(55245),h=i(1020),u=i(85773),f=i(62695),p=i(67280),g=i(89842),w=i(82542),m=i(80677),C=i(29872);const S=["searchTextInput"];function P(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",15),a.\u0275\u0275elementStart(1,"dw-form-item",16),a.\u0275\u0275elementStart(2,"dw-form-control",17),a.\u0275\u0275elementStart(3,"dw-input-group",18),a.\u0275\u0275elementStart(4,"input",19,20),a.\u0275\u0275listener("ngModelChange",function(t){return a.\u0275\u0275restoreView(e),a.\u0275\u0275nextContext().searchText=t}),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("dwSm",24)("dwXs",24),a.\u0275\u0275advance(2),a.\u0275\u0275propertyInterpolate("placeholder",a.\u0275\u0275pipeBind1(6,4,"dw-pleaseEnter")),a.\u0275\u0275property("ngModel",e.searchText)}}function b(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"th",21),a.\u0275\u0275listener("dwCheckedChange",function(t){return a.\u0275\u0275restoreView(e),a.\u0275\u0275nextContext().allChecked=t})("dwCheckedChange",function(t){return a.\u0275\u0275restoreView(e),a.\u0275\u0275nextContext().checkAll(t)}),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275property("dwWidth","54px")("dwChecked",e.allChecked)("dwIndeterminate",e.indeterminate)}}function D(e,t){1&e&&a.\u0275\u0275element(0,"th",22),2&e&&a.\u0275\u0275property("dwWidth","54px")}function y(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"th",23),a.\u0275\u0275listener("dwSortOrderChange",function(t){return a.\u0275\u0275restoreView(e).$implicit.sortOrder=t}),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;a.\u0275\u0275property("dwShowSort",e.isSort)("dwSortOrder",e.sortOrder)("dwColumnKey",e.field)("dwWidth",e.width),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(2,5,e.title))}}function O(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"td",28),a.\u0275\u0275listener("dwCheckedChange",function(){a.\u0275\u0275restoreView(e);const t=a.\u0275\u0275nextContext().$implicit;return a.\u0275\u0275nextContext().checkedChange(t)}),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275property("dwChecked",e.dwChecked)}}function x(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"td"),a.\u0275\u0275element(1,"label",29),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("dwValue",e.dwValue)}}function v(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div"),a.\u0275\u0275text(1),a.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate2(" ",e.key,":",e.value," ")}}function F(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275template(1,v,2,2,"div",33),a.\u0275\u0275pipe(2,"keyvalue"),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext(2).$implicit,t=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",a.\u0275\u0275pipeBind1(2,1,t[e.field]))}}const T=function(e,t,i,n,a,s){return[e,t,i,n,a,s]};function I(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275element(1,"div",34),a.\u0275\u0275pipe(2,"DwSelectModalCustomFilterPipe"),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext(2).$implicit,t=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("innerHtml",a.\u0275\u0275pipeBindV(2,1,a.\u0275\u0275pureFunction6(8,T,t[e.field],t,e.field,e.dataPipe,e.dataEnum,e.customPipe)),a.\u0275\u0275sanitizeHtml)}}function k(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"DwSelectModalCustomFilterPipe"),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext(2).$implicit,t=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBindV(2,1,a.\u0275\u0275pureFunction6(8,T,t[e.field],t,e.field,e.dataPipe,e.dataEnum,e.customPipe))," ")}}function E(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementContainerStart(1,30),a.\u0275\u0275template(2,F,3,3,"ng-container",31),a.\u0275\u0275template(3,I,3,15,"ng-container",31),a.\u0275\u0275template(4,k,3,15,"ng-container",32),a.\u0275\u0275elementContainerEnd(),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit,t=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(1),a.\u0275\u0275property("ngSwitch",t.getPipeType(e.dataPipe)),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngSwitchCase","keyvalue"),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngSwitchCase","custom")}}function M(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275text(1),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit,t=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",t[e.field]," ")}}function j(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"td"),a.\u0275\u0275template(1,E,5,3,"ng-container",26),a.\u0275\u0275template(2,M,2,1,"ng-container",26),a.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;a.\u0275\u0275classMap(e.dataClass),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",null!==e.dataPipe),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",null===e.dataPipe)}}function _(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"tr",24),a.\u0275\u0275listener("click",function(){const t=a.\u0275\u0275restoreView(e).$implicit;return a.\u0275\u0275nextContext().rowsClick(t)}),a.\u0275\u0275template(1,O,1,1,"td",25),a.\u0275\u0275template(2,x,2,1,"td",26),a.\u0275\u0275template(3,j,3,4,"td",27),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",e.defs.multiSelect),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",!e.defs.multiSelect),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",e.defs.colDefs)}}function V(e,t){1&e&&a.\u0275\u0275elementContainer(0)}const z=function(e,t){return{$implicit:e,config:t}};function $(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",35),a.\u0275\u0275template(1,V,1,0,"ng-container",36),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext(),t=a.\u0275\u0275reference(18);a.\u0275\u0275advance(1),a.\u0275\u0275property("ngTemplateOutlet",e.selectedCountTemplate?e.selectedCountTemplate:t)("ngTemplateOutletContext",a.\u0275\u0275pureFunction2(2,z,e.selectedCompleteDatas.length,e.defs))}}function R(e,t){1&e&&a.\u0275\u0275elementContainer(0)}function N(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275elementStart(1,"dw-tag",39),a.\u0275\u0275listener("dwOnClose",function(t){const i=a.\u0275\u0275restoreView(e).$implicit;return a.\u0275\u0275nextContext(2).onTagClose(t,i)}),a.\u0275\u0275template(2,R,1,0,"ng-container",36),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=a.\u0275\u0275nextContext(2),n=a.\u0275\u0275reference(16);a.\u0275\u0275advance(1),a.\u0275\u0275property("dwColor",i.defs.dwTagColor?i.defs.dwTagColor:"blue"),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngTemplateOutlet",i.tagTemplate?i.tagTemplate:n)("ngTemplateOutletContext",a.\u0275\u0275pureFunction2(3,z,e,i.defs))}}function L(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",37),a.\u0275\u0275template(1,N,3,6,"span",38),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",e.selectedCompleteDatas)("ngForTrackBy",e.trackById)}}function B(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275text(1),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit,t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",t.showCustomTag(e)," ")}}function Q(e,t){if(1&e&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275text(1),a.\u0275\u0275elementContainerEnd()),2&e){const e=a.\u0275\u0275nextContext(),t=e.$implicit,i=e.config;a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate2(" (",t[i.idField],")",t[i.nameField]," ")}}function A(e,t){if(1&e&&(a.\u0275\u0275template(0,B,2,1,"ng-container",26),a.\u0275\u0275template(1,Q,2,2,"ng-container",26)),2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275property("ngIf",null!==e.defs.dwCustomTag),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",null===e.defs.dwCustomTag)}}const W=function(e){return{value:e}};function q(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"span",40),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd()),2&e){const e=t.$implicit,i=a.\u0275\u0275nextContext();a.\u0275\u0275property("ngStyle",i.setCountStyle()),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind2(2,2,"dw-select-modal-selected-count",a.\u0275\u0275pureFunction1(5,W,e)))}}class K{setTableColDefs(e){this.tableColDefs=e}setInitParams(e){this.initParams=e}setCustomFilterPipe(e){this.customFilterPipe=e}setInitCondition(){this.initParams&&this.initParams.length>=0&&this.initParams.forEach(e=>{e instanceof n.DwQueryConditionInfo&&this.queryInfo.condition.addCondition(e)}),this.initParams&&this.initParams instanceof n.DwQueryCondition&&this.queryInfo.condition.addCondition(this.initParams)}converData(){!this.result||0===this.result.length||!this.customFilterPipe||this.result.forEach(e=>{Object.keys(e).forEach(t=>{const i=this.tableColDefs.filter(e=>e.field===t);this.customFilterPipe.transform(e[t],e,t,i[0]&&i[0].dataPipe?i[0].dataPipe:null,i[0]&&i[0].dataEnum?i[0].dataEnum:null,i[0]&&i[0].customPipe?i[0].customPipe:null)})})}}class J{setTableColDefs(e){this.tableColDefs=e}setInitParams(e){this.initParams=e}setCustomFilterPipe(e){this.customFilterPipe=e}setOrderBy(e){!e.name||this.queryInfo.addOrderField(e)}setInitCondition(){this.initParams&&this.initParams.length>=0&&this.initParams.forEach(e=>{e instanceof n.DwQueryConditionInfo&&this.queryInfo.condition.addCondition(e)}),this.initParams&&this.initParams instanceof n.DwQueryCondition&&this.queryInfo.condition.addCondition(this.initParams)}setQueryCondition(e){if(!e||0===this.searchFields.length)return;const t=new n.DwQueryCondition(n.DwQueryConditionOperator.OR);this.searchFields.forEach(i=>{let a=e;const s=this.getEnumKey(e,i);s&&(a=s),t.addCondition(new n.DwQueryConditionInfo(i,"%"+a+"%",n.DwQueryConditionOperator.LIKE))}),this.queryInfo.condition.addCondition(t)}getEnumKey(e,t){let i=null;const n=this.tableColDefs.find(e=>e.field===t);return!n||!n.hasOwnProperty("dataPipe")||"i18nSelect"!==n.dataPipe||!n.hasOwnProperty("dataEnum")||Object.keys(n.dataEnum).forEach(t=>{n.dataEnum[t].toString()===e&&(i=t)}),i}}const U=new a.InjectionToken("dwSystemConfig.dwSelectModalDefault",{providedIn:"root",factory:()=>[]});let G=(()=>{class e{constructor(){this.filterFields=[]}transform(e,t,i){return t&&i?(this.filterFields=i,e.filter(e=>{const i=this.getSearchRow(e);return Object.values(i).find(e=>{if(null!=e&&""!==e)return JSON.stringify(e).indexOf(t)>=0})})):e}getSearchRow(e){const t={};return Object.keys(e).forEach(i=>{this.filterFields.indexOf(i)>=0&&(t[i]=e[i])}),e.hasOwnProperty("_transform")&&e._transform&&Object.keys(e._transform).forEach(i=>{this.filterFields.indexOf(i)>=0&&(t.hasOwnProperty("_transform")||(t._transform={}),t._transform[i]=e._transform[i])}),t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=a.\u0275\u0275definePipe({name:"DwSelectModalSearchPipe",type:e,pure:!0}),e})();class H extends J{constructor(e,t,i,a){super(),this._url=t,this._tableName=i,this.listService=new n.DwListService(e),this.searchFields=a||[]}getDataList(e,t,i,a){return this.queryInfo=new n.DwQueryInfo,this.queryInfo.pageSize=t,this.queryInfo.pageNumber=e,this.queryInfo.condition=new n.DwQueryCondition,this.setInitCondition(),this.setQueryCondition(i),this.setOrderBy(a),this.listService.list(this._url,this.queryInfo.getRawValue()).pipe((0,s.map)(i=>(this._result={currentPage:e,datas:Object.assign([],i.data[this._tableName]),pageCount:i.pageCount,pageSize:t,rowCount:i.rowCount},this._result)))}}let X=(()=>{class e{constructor(e,t,i){this.dwModalRef=e,this.dwMessage=t,this.selectModalSearchPipe=i,this.searchText="",this.listOfData=[],this.allChecked=!1,this.indeterminate=!1,this.dwLoading=!1,this.selectedDataMap=new Map,this._selected=[],this.displayData=[],this.orderBy=new n.DwQueryOrder("",""),this.allyDatas=[],this.subscription=new r.Subscription,this.filterFields=[],this.trackById=(e,t)=>t[this.defs.idField],this.errorSubject=new r.BehaviorSubject(null),this.pageEvent$=new r.Subject,this.rowsCheckedEvent$=new r.Subject,this.rowsRadioEvent$=new r.Subject}set tableDefs(e){this.defs=Object.assign({},e),this.dwPageSize=this.defs.dwPageSize,this.dwPageIndex=1,this.defs.colDefs.forEach(e=>{e.sortOrder=null})}set selected(e){0!==e.length&&(this._selected=[...e])}get selected(){return this._selected}get selectedCompleteDatas(){return[...this.selectedDataMap.values()]}get errorSubject$(){return this.errorSubject.asObservable().pipe((0,s.filter)(e=>null!==e))}ngOnInit(){this.initRadioModel(),this.defs.dwFrontPagination=!1,this.dataSource instanceof K&&(this.defs.dwFrontPagination=!0),this.getDatas(),this.selectedDataToMap(),this.getFilterFields(),this.subscription.add(this.pageEvent$.pipe((0,s.debounceTime)(100)).subscribe(()=>{this.getDatas()})),this.subscription.add(this.rowsCheckedEvent$.pipe((0,s.debounceTime)(100)).subscribe(e=>{this.rowCheckedChange(e)})),this.subscription.add(this.rowsRadioEvent$.pipe((0,s.debounceTime)(100)).subscribe(e=>{this.updateRadio(e)}))}ngAfterViewInit(){const e=(0,r.fromEvent)(this._searchTextInput.nativeElement,"keyup").pipe((0,s.map)(e=>e.currentTarget.value)).pipe((0,s.debounceTime)(500));this.subscription.add(e.pipe((0,s.distinctUntilChanged)()).subscribe(e=>{this.dwPageIndex=1,this.dataSource instanceof K?this.searchDatas():this.getDatas()}))}ngOnDestroy(){this.subscription.unsubscribe()}setCountStyle(){return this.defs.dwSelectedCountColor?{color:this.defs.dwSelectedCountColor}:{}}selectedDataToMap(){this._selected.length&&this.defs.multiSelect&&this._selected.forEach(e=>{if("object"==typeof e){if(!e.hasOwnProperty(this.defs.idField))return;e.hasOwnProperty(this.defs.nameField)||(e[this.defs.nameField]=""),this.selectedDataMap.set(e[this.defs.idField].toString(),e)}else{const t={};t[this.defs.idField]=e,t[this.defs.nameField]="",this.selectedDataMap.set(e,t)}})}currentPageDataChange(e){this.defs.hasOwnProperty("currentPageDataChange")&&"function"==typeof this.defs.currentPageDataChange&&this.defs.currentPageDataChange(e),this.displayData=e,this.refreshStatus()}pageIndexChange(){this.defs.hasOwnProperty("pageIndexChange")&&"function"==typeof this.defs.pageIndexChange&&this.defs.pageIndexChange(this.dwPageIndex),!(this.dataSource instanceof K)&&this.pageEvent$.next()}pageSizeChange(){this.defs.hasOwnProperty("pageSizeChange")&&"function"==typeof this.defs.pageSizeChange&&this.defs.pageSizeChange(this.dwPageSize),!(this.dataSource instanceof K)&&this.pageEvent$.next()}sortChange(e){this.defs.colDefs.forEach(t=>{t.field!==e.key&&(t.sortOrder=null)});let t="";if(e.value&&(t=e.value.replace(/end/,"")),this.dataSource instanceof K)if(t){const i=[...this.listOfData];this.listOfData=i.sort((i,n)=>"asc"===t?i[e.key]>n[e.key]?1:-1:n[e.key]>i[e.key]?1:-1)}else this.listOfData=this.allyDatas;else this.orderBy=new n.DwQueryOrder(e.key,t),this.getDatas()}refreshStatus(){const e=this.displayData.every(e=>!0===e.dwChecked),t=this.displayData.every(e=>!e.dwChecked);this.allChecked=e,this.indeterminate=!e&&!t,this.updateChecked()}checkAll(e){this.displayData.forEach(t=>{t.dwChecked=e}),this.refreshStatus()}getSelectedValue(){return this._selected}onTagClose(e,t){this.listOfData.forEach(e=>{e[this.defs.idField].toString()===t[this.defs.idField].toString()&&(t.dwChecked=!1)});const i=t[this.defs.idField].toString(),n=this._selected.find(e=>"object"==typeof e?e[this.defs.idField].toString()===i:e.toString()===i);if(n){let e=-1;e="object"==typeof n?this._selected.map(e=>e[this.defs.idField].toString()).indexOf(i):this._selected.map(e=>e.toString()).indexOf(i),e>=0&&(this._selected.splice(e,1),this.selectedDataMap.delete(i))}this.refreshStatus()}getDatas(){this.dwLoading=!0,this.subscription.add(this.dataSource.getDataList(this.dwPageIndex,this.dwPageSize,this.searchText,this.orderBy).subscribe(e=>{this.dwLoading=!1,this.listOfData=e.datas,this.allyDatas=e.datas,this.setPagination(e),this.initOptions(),this.checkDataMapping()},e=>{this.errorSubject.next(e)}))}setPagination(e){this.dwPageIndex=e.currentPage,this._pageCount=e.pageCount,this.dwPageSize=e.pageSize,this.dwTotal=e.rowCount}initRadioModel(){if(!this.defs.multiSelect&&0!==this._selected.length){if(null==this._selected[0])return void(this.radioModel=this._selected[0]);this.radioModel="object"==typeof this._selected[0]?this._selected[0].hasOwnProperty(this.defs.idField)?this._selected[0][this.defs.idField].toString():null:this._selected[0].toString()}}updateChecked(){!this.defs.multiSelect||0===this.listOfData.length||(this.listOfData.filter(e=>!0===e.dwChecked).map(e=>{const t=this.getSelectRows(e),i=e[this.defs.idField].toString();this._selected.find(e=>"object"==typeof e?e[this.defs.idField].toString()===i:e.toString()===i)||(this._selected.push(t),this.selectedDataMap.set(e[this.defs.idField].toString(),e))}),this.listOfData.filter(e=>!e.dwChecked).map(e=>{const t=e[this.defs.idField].toString(),i=this._selected.find(e=>"object"==typeof e?e[this.defs.idField].toString()===t:e.toString()===t);if(i){let e=-1;e="object"==typeof i?this._selected.map(e=>e[this.defs.idField].toString()).indexOf(t):this._selected.map(e=>e.toString()).indexOf(t),e>=0&&(this._selected.splice(e,1),this.selectedDataMap.delete(t))}}))}initOptions(){this.listOfData.forEach(this.defs.multiSelect?e=>{e.dwChecked=this.isChecked(e),e.dwChecked&&this.selectedDataMap.set(e[this.defs.idField].toString(),e)}:e=>{e.dwValue=e[this.defs.idField].toString()})}isChecked(e){return 0!==this._selected.length&&void 0!==this._selected.find(t=>{if(null!=t)return"object"==typeof t?t.hasOwnProperty(this.defs.idField)?t[this.defs.idField].toString()===e[this.defs.idField].toString():void 0:t.toString()===e[this.defs.idField].toString()})}checkDataMapping(){if(!this.hasOwnProperty("listOfData")||0===this.listOfData.length)return void console.warn("datas is undefined");(!this.defs.hasOwnProperty("colDefs")||0===this.defs.colDefs.length)&&console.error("colDefs is undefined");const e=Object.keys(this.listOfData[0]),t=[];this.defs.colDefs.forEach(e=>{t.push(e.field)}),t.forEach(t=>{-1===e.indexOf(t)&&console.error(`${t} is not exist`)})}searchDatas(){this.listOfData=this.selectModalSearchPipe.transform(this.allyDatas,this.searchText,this.filterFields)}getPipeType(e){return e.indexOf("keyvalue")>=0?"keyvalue":e.indexOf("custom")>=0?"custom":""}rowsClick(e){this.defs.multiSelect?this.rowsCheckedEvent$.next(e):this.rowsRadioEvent$.next(e)}checkedChange(e){this.rowsCheckedEvent$.next(e)}rowCheckedChange(e){e.dwChecked=!e.dwChecked,this.refreshStatus()}updateRadio(e){this.radioModel=e.dwValue.toString(),this._selected.splice(0,this._selected.length);const t=this.getSelectRows(e);this._selected.push(t)}radioChange(e){const t=this.allyDatas.find(t=>t[this.defs.idField].toString()===e.toString());this.rowsRadioEvent$.next(t)}getSelectRows(e){if(void 0===this.returnFields)return e[this.defs.idField];const t=Object.assign({},e);return null===this.returnFields||0===this.returnFields.length?(delete t._transform,t):(Object.keys(t).forEach(e=>{-1===this.returnFields.indexOf(e)&&e!==this.defs.idField&&delete t[e]}),t)}showCustomTag(e){let t=null;return this.defs.hasOwnProperty("dwCustomTag")&&"function"==typeof this.defs.dwCustomTag&&(t=this.defs.dwCustomTag(e)),t}getFilterFields(){this.defs.colDefs.forEach(e=>{this.filterFields.push(e.field)})}}return e.\u0275fac=function(t){return new(t||e)(a.\u0275\u0275directiveInject(d.DwModalRef),a.\u0275\u0275directiveInject(l.DwMessageService),a.\u0275\u0275directiveInject(G))},e.\u0275cmp=a.\u0275\u0275defineComponent({type:e,selectors:[["app-select-modal"]],viewQuery:function(e,t){if(1&e&&a.\u0275\u0275viewQuery(S,5),2&e){let e;a.\u0275\u0275queryRefresh(e=a.\u0275\u0275loadQuery())&&(t._searchTextInput=e.first)}},inputs:{tableDefs:"tableDefs",selected:"selected",dataSource:"dataSource",returnFields:"returnFields",tagTemplate:"tagTemplate",selectedCountTemplate:"selectedCountTemplate"},decls:19,vars:19,consts:[[1,"dw-f-content-list"],["dw-row","","class","dw-f-form-head",4,"ngIf"],[1,"dw-f-table"],["name","radioGroup",3,"ngModel","ngModelChange"],[1,"selectModalTable",3,"dwData","dwPageSize","dwTotal","dwPageIndex","dwLoading","dwFrontPagination","dwShowPagination","dwShowSizeChanger","dwNoResult","dwPageSizeOptions","dwScroll","dwPageSizeChange","dwTotalChange","dwPageIndexChange","dwLoadingChange","dwCurrentPageDataChange","dwPageSizeOptionsChange"],["selectionTable",""],[3,"dwSortOrderChange"],["dwShowCheckbox","",3,"dwWidth","dwChecked","dwIndeterminate","dwCheckedChange",4,"ngIf"],[3,"dwWidth",4,"ngIf"],[3,"dwShowSort","dwSortOrder","dwColumnKey","dwWidth","dwSortOrderChange",4,"ngFor","ngForOf"],[3,"click",4,"ngFor","ngForOf"],["class","dw-f-pop-selected-count",4,"ngIf"],["class","dw-f-pop-tag-select",4,"ngIf"],["defaultTag",""],["defaultCount",""],["dw-row","",1,"dw-f-form-head"],["dw-row",""],["dwSpan","24","dw-col","",3,"dwSm","dwXs"],["dwSuffixIcon","search"],["type","text","dw-input","","name","searchText",3,"placeholder","ngModel","ngModelChange"],["searchTextInput",""],["dwShowCheckbox","",3,"dwWidth","dwChecked","dwIndeterminate","dwCheckedChange"],[3,"dwWidth"],[3,"dwShowSort","dwSortOrder","dwColumnKey","dwWidth","dwSortOrderChange"],[3,"click"],["dwShowCheckbox","",3,"dwChecked","dwCheckedChange",4,"ngIf"],[4,"ngIf"],[3,"class",4,"ngFor","ngForOf"],["dwShowCheckbox","",3,"dwChecked","dwCheckedChange"],["dw-radio","",3,"dwValue"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngFor","ngForOf"],[3,"innerHtml"],[1,"dw-f-pop-selected-count"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"dw-f-pop-tag-select"],[4,"ngFor","ngForOf","ngForTrackBy"],["dwMode","closeable",1,"dw-f-tag-s",3,"dwColor","dwOnClose"],[1,"dw-default-selected-count",3,"ngStyle"]],template:function(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"dw-content",0),a.\u0275\u0275template(1,P,7,6,"div",1),a.\u0275\u0275elementStart(2,"div",2),a.\u0275\u0275elementStart(3,"dw-radio-group",3),a.\u0275\u0275listener("ngModelChange",function(e){return t.radioModel=e})("ngModelChange",function(e){return t.radioChange(e)}),a.\u0275\u0275elementStart(4,"dw-table",4,5),a.\u0275\u0275listener("dwPageSizeChange",function(e){return t.dwPageSize=e})("dwTotalChange",function(e){return t.dwTotal=e})("dwPageIndexChange",function(e){return t.dwPageIndex=e})("dwLoadingChange",function(e){return t.dwLoading=e})("dwCurrentPageDataChange",function(e){return t.currentPageDataChange(e)})("dwPageIndexChange",function(){return t.pageIndexChange()})("dwPageSizeChange",function(){return t.pageSizeChange()})("dwPageSizeOptionsChange",function(e){return t.defs.dwPageSizeOptions=e}),a.\u0275\u0275elementStart(6,"thead",6),a.\u0275\u0275listener("dwSortOrderChange",function(e){return t.sortChange(e)}),a.\u0275\u0275elementStart(7,"tr"),a.\u0275\u0275template(8,b,1,3,"th",7),a.\u0275\u0275template(9,D,1,1,"th",8),a.\u0275\u0275template(10,y,3,7,"th",9),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(11,"tbody"),a.\u0275\u0275template(12,_,4,3,"tr",10),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(13,$,2,5,"div",11),a.\u0275\u0275template(14,L,2,2,"div",12),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(15,A,2,2,"ng-template",null,13,a.\u0275\u0275templateRefExtractor),a.\u0275\u0275template(17,q,3,7,"ng-template",null,14,a.\u0275\u0275templateRefExtractor)),2&e){const e=a.\u0275\u0275reference(5);a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",t.defs.isFilter),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngModel",t.radioModel),a.\u0275\u0275advance(1),a.\u0275\u0275property("dwData",t.listOfData)("dwPageSize",t.dwPageSize)("dwTotal",t.dwTotal)("dwPageIndex",t.dwPageIndex)("dwLoading",t.dwLoading)("dwFrontPagination",t.defs.dwFrontPagination)("dwShowPagination",t.defs.dwShowPagination)("dwShowSizeChanger",t.defs.dwShowSizeChanger)("dwNoResult",t.defs.dwNoResult)("dwPageSizeOptions",t.defs.dwPageSizeOptions)("dwScroll",t.defs.dwScroll),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",t.defs.multiSelect),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",!t.defs.multiSelect),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",t.defs.colDefs),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngForOf",e.data),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",t.defs.showSelectedCount&&t.defs.multiSelect&&t.selectedCompleteDatas.length),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",t.defs.showTag&&t.defs.multiSelect)}},directives:function(){return[m.DwContentComponent,c.NgIf,w.DwRadioGroupComponent,h.NgControlStatus,h.NgModel,f.DwTableComponent,f.DwTheadComponent,f.DwTrDirective,c.NgForOf,f.DwTbodyComponent,C.DwRowDirective,u.DwFormItemComponent,C.DwColDirective,u.DwFormControlComponent,p.DwInputGroupComponent,p.DwInputDirective,h.DefaultValueAccessor,f.DwTableCellDirective,f.DwThMeasureDirective,f.DwThSelectionComponent,f.DwThAddOnComponent,f.DwTdAddOnComponent,w.DwRadioComponent,c.NgSwitch,c.NgSwitchCase,c.NgSwitchDefault,c.NgTemplateOutlet,g.DwTagComponent,c.NgStyle]},pipes:function(){return[o.TranslatePipe,c.KeyValuePipe,Y]},styles:[""]}),e})(),Y=(()=>{class e{constructor(e,t,i,n,a,s,r,o,l,d){this.currencyPipe=e,this.datePipe=t,this.decimalPipe=i,this.i18nSelectPipe=n,this.jsonPipe=a,this.lowerCasePipe=s,this.percentPipe=r,this.slicePipe=o,this.upperCasePipe=l,this.titleCasePipe=d}transform(e,t,i,n,a,s){return null!=e&&""!==e&&n?(this.retValue=e,this.rows=t,this.col=i,this.dataEnum=null,this.customPipe=null,null!==a&&(this.dataEnum=a),null!==s&&(this.customPipe=s),n.split("|").forEach(e=>{this.converData(e)}),this.saveConverData(),this.retValue):e}converData(e){const t=e.split(":");switch(t[0]){case"date":this.retValue=this.datePipe.transform(this.retValue,t[1],t[2],t[3]);break;case"currency":this.retValue=this.currencyPipe.transform(this.retValue,t[1],t[2],t[3],t[4]);break;case"uppercase":this.retValue=this.upperCasePipe.transform(this.retValue);break;case"lowercase":this.retValue=this.lowerCasePipe.transform(this.retValue);break;case"titlecase":this.retValue=this.titleCasePipe.transform(this.retValue);break;case"number":this.retValue=this.decimalPipe.transform(this.retValue,t[1]);break;case"percent":this.retValue=this.percentPipe.transform(this.retValue,t[1],t[2]);break;case"slice":this.retValue=this.slicePipe.transform(this.retValue,Number(t[1]),Number(t[2]));break;case"json":this.retValue=this.jsonPipe.transform(this.retValue);break;case"i18nSelect":null!==this.dataEnum&&(this.retValue=this.i18nSelectPipe.transform(this.retValue.toString(),this.dataEnum));break;case"custom":const e=JSON.parse(JSON.stringify(t));e.shift(),this.retValue=this.customPipe.transform(this.retValue,e)}}saveConverData(){if(!this.rows||(this.rows.hasOwnProperty("_transform")||(this.rows._transform={}),Object.keys(this.rows._transform).indexOf(this.col)>=0))return;let e=this.retValue;e&&e.hasOwnProperty("changingThisBreaksApplicationSecurity")&&(e=String(e.changingThisBreaksApplicationSecurity).replace(/<[^>]+>/gm,"")),this.rows._transform[this.col]=e}}return e.\u0275fac=function(t){return new(t||e)(a.\u0275\u0275directiveInject(c.CurrencyPipe,16),a.\u0275\u0275directiveInject(c.DatePipe,16),a.\u0275\u0275directiveInject(c.DecimalPipe,16),a.\u0275\u0275directiveInject(c.I18nSelectPipe,16),a.\u0275\u0275directiveInject(c.JsonPipe,16),a.\u0275\u0275directiveInject(c.LowerCasePipe,16),a.\u0275\u0275directiveInject(c.PercentPipe,16),a.\u0275\u0275directiveInject(c.SlicePipe,16),a.\u0275\u0275directiveInject(c.UpperCasePipe,16),a.\u0275\u0275directiveInject(c.TitleCasePipe,16))},e.\u0275pipe=a.\u0275\u0275definePipe({name:"DwSelectModalCustomFilterPipe",type:e,pure:!0}),e})(),Z=(()=>{class e{constructor(e,t,i,n,a){this.dwModalService=e,this.translateService=t,this.dwMessage=i,this.openSelectModalDefault=n,this.dwSelectModalCustomFilterPipe=a}getDefaultConfig(){return{modalTitle:"default",modalWidth:"80%",modalOkText:"dw-determine",modalCancelText:"dw-cancel",modalOnOk:()=>{},modalOnCancel:()=>{},modalAfterClose:()=>{},modalAfterOpen:()=>{},tableIdField:"",tableNameField:"",tableColDefs:[],tableMultiSelect:!0,tableShowTag:!0,tableShowSelectedCount:!1,tableIsFilter:!0,tablePageSize:50,tableShowPagination:!0,tableShowSizeChanger:!0,tableNoResult:"",tablePageSizeOptions:[5,10,15,20],tableTagColor:"",tableSelectedCountColor:"",tableCustomTag:null,tableScroll:{},tablePageIndexChange:()=>{},tablePageSizeChange:()=>{},tableCurrentPageDataChange:()=>{},dataSource:null,returnFields:null,initParams:null}}_checkCustomizeConfig(e){if(!e.hasOwnProperty("dataSource")||!e.dataSource||"function"!=typeof e.dataSource.getDataList)return this.dwMessage.error(this.translateService.instant("dw-select-modal-error-dataSource")),!1;if(!e.tableIdField)return this.dwMessage.error(this.translateService.instant("dw-select-modal-error-tableIdField")),!1;if(!e.tableNameField)return this.dwMessage.error(this.translateService.instant("dw-select-modal-error-tableNameField")),!1;if(!e.tableColDefs.length)return this.dwMessage.error(this.translateService.instant("dw-select-modal-error-tableColDefs")),!1;const t=[];return e.tableColDefs.forEach(e=>{(!e.hasOwnProperty("title")||!e.title)&&t.push(this.translateService.instant("dw-select-modal-error-tableColDefs-title")),(!e.hasOwnProperty("field")||!e.field)&&t.push(this.translateService.instant("dw-select-modal-error-tableColDefs-field"))}),!t.length||(this.dwMessage.error(t.join("\\n")),!1)}setModalConfig(e){this.modalConfig=Object.assign({},{dwTitle:e.modalTitle,dwWidth:e.modalWidth,dwOkText:e.modalOkText,dwCancelText:e.modalCancelText,onOk:e.modalOnOk,onCancel:e.modalOnCancel,afterClose:e.modalAfterClose,afterOpen:e.modalAfterOpen})}getTableColDefs(e){const t=[];return e.forEach(e=>{const i=Object.assign({},e);(!i.hasOwnProperty("isSort")||"boolean"!=typeof i.isSort)&&(i.isSort=!0),i.hasOwnProperty("dataPipe")||(i.dataPipe=null),i.hasOwnProperty("dataEnum")||(i.dataEnum=null),i.hasOwnProperty("customPipe")||(i.customPipe=null),t.push(i)}),t}setTableConfig(e){const t=this.getTableColDefs(e.tableColDefs);this.tableDefs=Object.assign({},{idField:e.tableIdField,nameField:e.tableNameField,colDefs:t,multiSelect:e.tableMultiSelect,dwPageSize:e.tablePageSize,showTag:e.tableShowTag,showSelectedCount:e.tableShowSelectedCount,isFilter:e.tableIsFilter,dwShowPagination:e.tableShowPagination,dwShowSizeChanger:e.tableShowSizeChanger,pageIndexChange:e.tablePageIndexChange,pageSizeChange:e.tablePageSizeChange,currentPageDataChange:e.tableCurrentPageDataChange,dwNoResult:e.tableNoResult,dwPageSizeOptions:e.tablePageSizeOptions,dwTagColor:e.tableTagColor,dwSelectedCountColor:e.tableSelectedCountColor,dwCustomTag:e.tableCustomTag,dwScroll:e.tableScroll})}setConfig(e){const t=this.getDefaultConfig(),i=Object.assign(Object.assign(Object.assign({},t),this.openSelectModalDefault),e);this.setModalConfig(i),this.setTableConfig(i)}translateConfig(){this.modalConfig.dwTitle=this.translateService.instant(this.modalConfig.dwTitle),this.modalConfig.dwOkText=this.translateService.instant(this.modalConfig.dwOkText),this.modalConfig.dwCancelText=this.translateService.instant(this.modalConfig.dwCancelText)}getSelected(e){let t=[];return e&&(t=e,"string"==typeof e&&(t=[e])),t}setEvents(){this.modalConfig.dwOnOk=e=>{const t=e.getSelectedValue();this.modalSubject.next(t),this.modalSubject.complete(),this.modalConfig.onOk()},this.modalConfig.dwOnCancel=e=>{this.modalSubject.complete(),this.modalConfig.onCancel()};const e={afterClose:this.modalConfig.afterClose,afterOpen:this.modalConfig.afterOpen};return delete this.modalConfig.afterClose,delete this.modalConfig.afterOpen,e}createModal(e,t,i,n){let a;const s=Object.assign({dwContent:X,dwFooter:[{label:this.modalConfig.dwCancelText,shape:null,onClick(){a.triggerCancel()}},{label:this.modalConfig.dwOkText,type:"primary",onClick(){a.triggerOk()}}],dwComponentParams:{tableDefs:this.tableDefs,selected:t,dataSource:e.dataSource,returnFields:e.returnFields,tagTemplate:i,selectedCountTemplate:n}},this.modalConfig);return a=this.dwModalService.create(s),a}open(e,t,i,n){if(this.modalSubject=new r.Subject,!this._checkCustomizeConfig(e))return this.modalSubject.complete(),this.modalSubject;e.dataSource.setInitParams(e.initParams),e.dataSource.setTableColDefs(e.tableColDefs),e.dataSource.setCustomFilterPipe(this.dwSelectModalCustomFilterPipe),this.setConfig(e),this.translateConfig();const a=this.setEvents(),s=this.getSelected(t),o=this.createModal(e,s,i,n);return o.afterClose.subscribe(()=>{a.afterClose()}),o.afterOpen.subscribe(()=>{a.afterOpen(),o.getContentComponent().errorSubject$.subscribe(e=>{this.modalSubject.error(e),this.modalSubject.complete(),o.triggerCancel()})}),this.modalSubject.asObservable()}}return e.\u0275fac=function(t){return new(t||e)(a.\u0275\u0275inject(d.DwModalService),a.\u0275\u0275inject(o.TranslateService),a.\u0275\u0275inject(l.DwMessageService),a.\u0275\u0275inject(U),a.\u0275\u0275inject(Y))},e.\u0275prov=a.\u0275\u0275defineInjectable({factory:function(){return new e(a.\u0275\u0275inject(d.DwModalService),a.\u0275\u0275inject(o.TranslateService),a.\u0275\u0275inject(l.DwMessageService),a.\u0275\u0275inject(U),a.\u0275\u0275inject(Y))},token:e,providedIn:"root"}),e})(),ee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=a.\u0275\u0275defineInjector({providers:[G,Y,c.CurrencyPipe,c.DatePipe,c.DecimalPipe,c.I18nSelectPipe,c.JsonPipe,c.LowerCasePipe,c.PercentPipe,c.SlicePipe,c.UpperCasePipe,c.TitleCasePipe],imports:[[c.CommonModule,h.FormsModule,u.DwFormModule,f.DwTableModule,p.DwInputModule,g.DwTagModule,w.DwRadioModule,m.DwLayoutModule,o.TranslateModule]]}),e})()}}]);