"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[4060,1800],{4060:function(t,e,s){s.r(e),s.d(e,{CREATE:function(){return b},DELETE:function(){return m},DwCreateService:function(){return l},DwDataRow:function(){return D},DwDataSet:function(){return j},DwDataTable:function(){return O},DwDeleteService:function(){return f},DwDocDeleteDirective:function(){return k},DwDocReadDirective:function(){return _},DwDocSaveDirective:function(){return F},DwDocument:function(){return y},DwDocumentModule:function(){return I},DwExtraFieldsService:function(){return S},DwListService:function(){return p},DwMetadataService:function(){return w},DwQueryCondition:function(){return A},DwQueryConditionInfo:function(){return C},DwQueryConditionOperator:function(){return R},DwQueryInfo:function(){return T},DwQueryOrder:function(){return E},DwReadService:function(){return u},DwUpdateService:function(){return h},UPDATE:function(){return g}});var r=s(42746),i=s(1020),n=s(71049),o=s(47372),c=s(99487),a=s(55245),d=s(30469);let l=(()=>{class t{constructor(t){this.http=t}create(t,e){return this.http.post(t,{dataset:e})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),u=(()=>{class t{constructor(t){this.http=t}read(t,e){let s;return s=Array.isArray(e)?e:[e],this.http.get(t,{params:{oids:JSON.stringify(s)}})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),h=(()=>{class t{constructor(t){this.http=t}update(t,e){return this.http.put(t,{dataset:e})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),f=(()=>{class t{constructor(t){this.http=t}delete(t,e){return Array.isArray(e)?this.http.request("DELETE",t,{body:{oids:e}}):this.http.request("DELETE",t,{body:{dataset:e}})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),p=(()=>{class t{constructor(t){this.http=t}list(t,e){return this.http.get(t,{params:{queryInfo:JSON.stringify(e)}})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),w=(()=>{class t{constructor(t){this.http=t}getMetadata(t){return this.http.get("//assets/metadata/"+t+".json")}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})();class v extends i.FormControl{updateValue(t){this.markAsDirty(),this.setValue(t)}reset(t,e){super.reset(t,e),this.markAsPristine(),this.markAsUntouched(),this.errors&&this.setErrors({})}}const m="d",b="c",g="u";class D extends i.FormGroup{constructor(t){const e={};Object.keys(t).forEach(s=>{e[s]=new v(t[s])}),super(e),this.modifyState="",this._childs={}}get columns(){return this.controls}get $state(){return this.modifyState}addChild(t,e){this._childs[t]=e}addChildRow(t,e){this._childs[t]||(this._childs[t]=[]),this._childs[t].push(e)}markAsDirty(){this.markAsUpdate(),super.markAsDirty()}markAsPristine(){this.modifyState===g&&(this.modifyState=""),super.markAsPristine()}markAsDelete(t=!1){this.modifyState=m}markAsCreate(t=!1){(""===this.modifyState||t)&&(this.modifyState=b)}markAsUpdate(t=!1){(""===this.modifyState||t)&&(this.modifyState=g)}get active(){return this.modifyState!==m}batchColumnsValidator(t){Object.keys(this.columns).forEach(e=>{t[e]&&this.columns[e].setValidators(t[e])})}getRawValue(){const t=super.getRawValue();return t.$state=this.modifyState,"child"in t&&delete t.child,Object.keys(t).forEach(e=>{t[e]instanceof Date&&(t[e]=new a.DatePipe("zh_tw").transform(t[e],"yyyy/MM/dd HH:mm:ss"))}),t}}class O extends i.FormArray{constructor(t){const e=[];for(const s of t)e.push(new D(s));super(e),this._activeRows=e.filter(t=>t.$state!==m)}get rows(){return this.controls}get activeRows(){return this._activeRows}insertRow(t,e,s=!0){const r=e instanceof D?e:new D(e);s&&r.markAsCreate(),this.insert(t,r),this._activeRows=this.controls.filter(t=>t.$state!==m)}pushRow(t,e=!0){const s=t instanceof D?t:new D(t);e&&s.markAsCreate(),this.push(s),this._activeRows=this.controls.filter(t=>t.$state!==m)}updateRow(t,e){if(!this.rows[t])throw new Error(`Must supply a value for form control at index: ${t}.`);e instanceof D?this.rows[t]=e:this.rows[t].setValue(e),this.rows[t].markAsUpdate(),this._activeRows=this.controls.filter(t=>t.$state!==m)}batchColumnsValidator(t){this.rows.forEach(e=>{e.batchColumnsValidator(t)})}deleteRow(t){this.controls[t]&&this.doDeleteRow(t),this._activeRows=this.controls.filter(t=>t.$state!==m)}doDeleteRow(t){this.controls[t].$state===b?this.controls.splice(t,1):this.controls[t].markAsDelete()}clearRows(){for(let t=this.controls.length-1;t>=0;t-=1)this.controls[t].$state!==m&&this.doDeleteRow(t);this._activeRows=this.controls.filter(t=>t.$state!==m)}}let S=(()=>{class t{constructor(t){this.http=t}getCustomizeField(t){return(0,n.of)({})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(c.HttpClient))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})(),y=(()=>{class t extends i.FormGroup{constructor(t,e,s,r,i,o,c,a,d,l,u){super({}),this.createService=t,this.readService=e,this.updateService=s,this.deleteService=r,this.listService=i,this.metadataService=o,this.extraFieldsService=c,this.dwDateFormat=a,this.dwTimeFormat=d,this.documentId=l,this.resource=u,this._haveRead=!1,this.eventPool=[],this.extraFieldConfigObservableMapping=new Map,this.event$=(0,n.from)(this.eventPool)}get tables(){return this.controls}get haveRead(){return this._haveRead}getExtraFieldsConfig(t){return this.getExtraConfigSubject(t).asObservable().pipe((0,o.filter)(t=>null!==t))}getExtraConfigSubject(t){let e;return this.extraFieldConfigObservableMapping.has(t)?e=this.extraFieldConfigObservableMapping.get(t):(e=new n.BehaviorSubject(null),this.extraFieldConfigObservableMapping.set(t,e)),e}registerEvent(t){this.eventPool.push(t)}jsonToTables(t){const e={};for(const[s,r]of Object.entries(t))if(Array.isArray(r)){this.get(s)||this.addControl(s,new O([])),e[s]||(e[s]=[]);for(const t of r){t.child&&(this.jsonToTables(t.child),delete t.child);const r=new D(t);this.get(s).pushRow(r,!1),e[s].push(r)}}}parseToDataTable(t){for(const[e,s]of Object.entries(t)){const t=new O(s);this.addControl(e,t)}return{}}reading(){return this.event$.pipe((0,o.filter)(t=>"reading"in t),(0,o.map)(t=>{const e=t.reading();return e instanceof n.Observable?e:(0,n.of)(e)}),(0,o.mergeAll)(),(0,o.reduce)((t,e)=>t&&e,!0))}readed(t){this.event$.subscribe(e=>{"readed"in e&&e.readed(t)})}read(t,e=!0){const s=this.reading().pipe((0,o.map)(e=>e?this.readService.read(this.resource,t):(0,n.of)()),(0,o.mergeAll)());return new n.Observable(t=>{s.subscribe(s=>{s.data&&(e&&this.clearTables(),this.jsonToTables(s.data)),this._haveRead=!0,t.next(this.controls),t.complete(),this.readed(s);const r=s.data.$custFieldsConfig;if(r)for(const t in r)this.getExtraConfigSubject(t).next(r[t])},e=>{t.error(e)})})}saving(){return this.event$.pipe((0,o.filter)(t=>"saving"in t),(0,o.map)(t=>{const e=t.saving();return e instanceof n.Observable?e:(0,n.of)(e)}),(0,o.mergeAll)(),(0,o.reduce)((t,e)=>t&&e,!0))}saved(t=null){this.event$.subscribe(e=>{"saved"in e&&e.saved(t)})}save(){let t;return this.saving().subscribe(),t=this.haveRead?this.update():this.create(),new n.Observable(e=>{t.subscribe(t=>{e.next(t),e.complete(),this.saved(t)},t=>{e.error(t)})})}create(){const t=this.getRawValue();for(const[e,s]of Object.entries(t))for(const t of s)t.$state=b,t.cust_field&&(this.transDateToString(t.cust_field),t.cust_field=JSON.stringify(t.cust_field));return this.createService.create(this.resource,t)}update(){const t=this.getRawValue(),e={};for(const[s,r]of Object.entries(t)){const t=[];for(const e of r)""!==e.$state&&(e.cust_field&&(this.transDateToString(e.cust_field),e.cust_field=JSON.stringify(e.cust_field)),t.push(e));e[s]=t}return this.updateService.update(this.resource,e)}deleting(){return this.event$.pipe((0,o.filter)(t=>"deleting"in t),(0,o.map)(t=>{const e=t.deleting();return e instanceof n.Observable?e:(0,n.of)(e)}),(0,o.mergeAll)(),(0,o.reduce)((t,e)=>t&&e,!0))}deleted(){this.event$.subscribe(t=>{"deleted"in t&&t.deleted()})}delete(t){this.deleting().subscribe();const e=this.getRawValue(),s={};for(const[r,i]of Object.entries(e)){const t=[];for(const e of i)e.$state===m&&t.push(e);s[r]=t}return console.log(s,"delete tables:"),this.deleted(),this.deleteService.delete(this.resource,t)}list(t){return this.listService.list(this.resource+"/List",t).pipe((0,o.map)(t=>{for(const[e,s]of Object.entries(t.data))!Array.isArray(s)||t.data[e].map(t=>(t.hasOwnProperty("cust_field")&&t.cust_field&&(t.cust_field=JSON.parse(t.cust_field)),t));return t}),(0,o.tap)(t=>{const e=t.data.$custFieldsConfig;if(e)for(const s in e)this.getExtraConfigSubject(s).next(e[s])}))}clearTables(){for(const t in this.controls)this.controls.hasOwnProperty(t)&&delete this.controls[t]}setControl(t,e){super.setControl(t,e),t&&this.extraFieldsService.getCustomizeField([t]).subscribe(e=>{e.data&&e.data[t]&&this.getExtraConfigSubject(t).next(e.data[t])})}transDateToString(t){const e=this.dwDateFormat.concat(" ",this.dwTimeFormat);for(const[s,r]of Object.entries(t))r instanceof Date&&(t[s]=new a.DatePipe("zh_tw").transform(r,e))}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275inject(l),r.\u0275\u0275inject(u),r.\u0275\u0275inject(h),r.\u0275\u0275inject(f),r.\u0275\u0275inject(p),r.\u0275\u0275inject(w),r.\u0275\u0275inject(S),r.\u0275\u0275inject(d.APP_DATE_FORMAT),r.\u0275\u0275inject(d.APP_TIME_FORMAT),r.\u0275\u0275inject("DocumentID"),r.\u0275\u0275inject("DocumentResource"))},t.\u0275prov=r.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t})();class j extends i.FormGroup{constructor(t,e,s){super(j.parseToControl(t),e,s)}get tables(){return this.controls}static parseToControl(t){const e={};for(const s in t)if(s){const r=new O(t[s]);e[s]=r}return e}}class E{constructor(t,e){this.name=t,this.orderby=e}}class C{constructor(t,e,s){this.name=t,this.operator=s,Array.isArray(e)?this.values=e:this.value=e}}var R=(()=>{return(t=R||(R={})).IN="IN",t.AND="AND",t.OR="OR",t.LIKE="LIKE",t.EQUAL="EQUAL",t.NOTEQUALS="NotEquals",t.LESSTHAN="LessThan",t.LESSTHANOREQUALTO="LessThanOrEqualTo",t.GREATERTHAN="GreaterThan",t.GREATERTHANOREQUALTO="GreaterThanOrEqualTo",t.BETWEEN="Between",R;var t})();class A{constructor(t=R.AND){this.joinOperator=t,this.items=[]}addCondition(t){this.items.push(t)}clearValue(){this.items.forEach(t=>{"value"in t?t.value="":"values"in t?t.values.splice(0,t.values.length):t instanceof A&&t.clearValue()})}}class T{constructor(){this.pageable=!0,this.pageSize=20,this.pageNumber=1,this.condition=null,this.conditionField={},this.orderfields={}}getRawValue(){const t={};this.pageable&&Object.assign(t,{pageSize:this.pageSize,pageNumber:this.pageNumber});const e=new A;for(const s of Object.values(this.conditionField))e.addCondition(s);return this.condition&&this.condition.items.length>0&&e.addCondition(this.condition),Object.assign(t,{orderfields:Object.values(this.orderfields),condition:e}),t}setCondition(t){this.condition=t}addConditionField(t){this.conditionField[t.name]=t}addOrderfield(t){console.error("addOrderfield will deprecated. it was superseded by the addOrderField"),this.addOrderField(t)}addOrderField(t){this.orderfields[t.name]=t}removeOrderField(t){t&&this.orderfields[t]&&delete this.orderfields[t]}clearOrderField(){this.orderfields={}}clearConditionValue(){this.condition.clearValue()}clear(){this.pageNumber=1,this.pageSize=20,this.orderfields={},this.condition=null,this.conditionField={}}}let k=(()=>{class t{constructor(t,e){this.el=t,this.doc=e,this.dwDocOnDelete=new r.EventEmitter}onClick(){this.doc.delete([this.oid]).subscribe(t=>{this.dwDocOnDelete.emit({success:t,error:null})},t=>{this.dwDocOnDelete.emit({success:null,error:t})})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(y))},t.\u0275dir=r.\u0275\u0275defineDirective({type:t,selectors:[["","dwDocDelete",""]],hostBindings:function(t,e){1&t&&r.\u0275\u0275listener("click",function(){return e.onClick()})},inputs:{oid:"oid"},outputs:{dwDocOnDelete:"dwDocOnDelete"}}),t})(),_=(()=>{class t{constructor(t,e){this.el=t,this.doc=e,this.dwDocOnRead=new r.EventEmitter}onClick(){this.doc.read([this.oid]).subscribe(t=>{this.dwDocOnRead.emit({success:t,error:null})},t=>{this.dwDocOnRead.emit({success:null,error:t})})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(y))},t.\u0275dir=r.\u0275\u0275defineDirective({type:t,selectors:[["","dwDocRead",""]],hostBindings:function(t,e){1&t&&r.\u0275\u0275listener("click",function(){return e.onClick()})},inputs:{oid:"oid"},outputs:{dwDocOnRead:"dwDocOnRead"}}),t})(),F=(()=>{class t{constructor(t,e){this.el=t,this.doc=e,this.dwDocOnSave=new r.EventEmitter}onClick(){this.doc.save().subscribe(t=>{this.dwDocOnSave.emit({success:t,error:null})},t=>{this.dwDocOnSave.emit({success:null,error:t})})}}return t.\u0275fac=function(e){return new(e||t)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(y))},t.\u0275dir=r.\u0275\u0275defineDirective({type:t,selectors:[["","dwDocSave",""]],hostBindings:function(t,e){1&t&&r.\u0275\u0275listener("click",function(){return e.onClick()})},outputs:{dwDocOnSave:"dwDocOnSave"}}),t})(),I=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=r.\u0275\u0275defineInjector({imports:[[a.CommonModule]]}),t})()}}]);