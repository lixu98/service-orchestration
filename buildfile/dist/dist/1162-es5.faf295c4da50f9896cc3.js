!function(){"use strict";function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[1162],{31868:function(e,n,s){s.r(n),s.d(n,{DwHttpApiInterceptor:function(){return S},DwHttpClient:function(){return C},DwHttpClientOptionsService:function(){return v},DwHttpErrorHandlerService:function(){return k},DwHttpLoadMaskService:function(){return M},DwHttpMessageLoginService:function(){return I},DwHttpMessageService:function(){return y},DwHttpModule:function(){return g},DwHttpRequestUrlService:function(){return w},DwSystemHttpErrorHandler:function(){return b}});var o,i=s(42746),u=s(55245),a=s(71049),c=s(83522),f=s(99487),l=s(32276),h=s(78597),d=s(30469),p=s(47372),g=((o=r(function e(){t(this,e)})).\u0275fac=function(e){return new(e||o)},o.\u0275mod=i.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=i.\u0275\u0275defineInjector({imports:[[u.CommonModule]]}),o),v=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"setLoadMaskCfg",value:function(e,r,t,n){return null}},{key:"getUiOptions",value:function(e){return null}},{key:"getLoadingMaskCfg",value:function(e){return null}}]),e}();return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e}(),w=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"getUrl",value:function(e,r){var t=e;return r.startsWith("http://")||r.startsWith("https://")||r.startsWith("//")||r.startsWith("assets/")?t=r:r&&(t=e+"/"+r),t}}]),e}();return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e}(),y=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"error",value:function(e,r){var t="",n="";return e?"string"==typeof e&&(n=e):r&&(r.hasOwnProperty("dwTitle")&&(t=r.dwTitle+"\n"),r.hasOwnProperty("dwContent")&&r.dwContent&&"string"==typeof r.dwContent&&(n=t+r.dwContent)),new a.Observable(function(e){n&&alert(n),e.next(!0),e.complete()})}},{key:"warning",value:function(e,r){var t=this.getMessage(e);return new a.Observable(function(e){alert(t),e.next(!0),e.complete()})}},{key:"confirm",value:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}(function(e){var r=this.getMessage(e);return new a.Observable(function(e){confirm(r)?(e.next(!0),e.complete()):(e.next(!1),e.complete())})})},{key:"create",value:function(e,r,t){var n=null;return"string"==typeof e&&(n=this.getMessage(r)),"object"==typeof e&&(n=this.getMessage(e)),new a.Observable(function(e){confirm(n)?(e.next(!0),e.complete()):(e.next(!1),e.complete())})}},{key:"getMessage",value:function(e){var r=[],t="error";return"string"==typeof e&&(t=e),"object"==typeof e&&(e.hasOwnProperty("dwTitle")&&r.push(e.dwTitle),e.hasOwnProperty("dwContent")&&r.push(e.dwContent),r.length>0&&(t=r.join("\n"))),t}}]),e}();return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e}(),M=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"showMask",value:function(e){}},{key:"hideMask",value:function(e){}},{key:"clear",value:function(){}}]),e}();return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e}(),k=function(){var e=function(){function e(r,n,s,o,i,u,a){var c=this;t(this,e),this.injector=r,this.dwLoggingService=n,this.dwMessageService=s,this.configService=o,this.translateService=i,this.dwHttpLoadMaskService=u,this.dwAppId=a,this.dwMultiTenant=!1,this.singleMsgShowing=!1,this.configService.get("multiTenant").subscribe(function(e){return c.dwMultiTenant=e}),this.configService.get("consoleUrl").subscribe(function(e){return c.consoleUrl=e}),this.configService.get("marketUrl").subscribe(function(e){return c.marketUrl=e})}return r(e,[{key:"handle",value:function(e){var r=this;if(e instanceof f.HttpErrorResponse){if(0===e.status)this.dwLoggingService.httpError(e);else if(e.error){var t=this.injector.get(l.DwAuthService),n=this.instructorToArray(e,[]);e.error.dwInstructorList=n;for(var s=!1,o=n.length,i=0;i<o;i++){var u=this.errorRule(n[i].sourceId,n[i].errorCode);if(u)if(u.handlerProcess){if(s=this.handlerProcess(n[i]))break}else{if(u.logout){s=!0,this.showMessageLogout(n[i].errorMessage,n[i].url,t);break}if(!u.logout){s=!0,this.showMessage(n[i].errorMessage,n[i].url);break}}else if("IAM"===n[i].sourceId&&401===n[i].status){s=!0,this.showMessageLogout(n[i].errorMessage,n[i].url,t);break}}if(!s&&o>0){var a=o-1;if(n[a].sourceId&&"10903"===n[a].errorCode||"10904"===n[a].errorCode){var c=n[0];c.hasOwnProperty("response")&&c.response.hasOwnProperty("message")&&(s=!0,!1===this.singleMsgShowing&&(this.singleMsgShowing=!0,this.dwMessageService.error(c.response.message).subscribe(function(e){r.singleMsgShowing=!1,"10904"===n[a].errorCode&&t.logout()})))}}s&&e.error.hasOwnProperty("errorMessage")&&(e.error.errorMessage="")}}else console.error(e)}},{key:"showMessageLogout",value:function(e,r,t){var n=this;if(e&&-1===r.indexOf("/logout")){if(!1===this.singleMsgShowing){this.singleMsgShowing=!0;var s={dwContent:e};this.dwHttpLoadMaskService.clear(),this.dwMessageService.error(null,s).subscribe(function(e){n.singleMsgShowing=!1,t.logout()})}}else t.logout()}},{key:"showMessage",value:function(e,r){var t=this;e&&!1===this.singleMsgShowing&&(this.singleMsgShowing=!0,this.dwMessageService.error(null,{dwContent:e+"<br>"+r}).subscribe(function(e){t.singleMsgShowing=!1}))}},{key:"instructorToArray",value:function(e,r){var t={status:null,url:"",sourceId:"",errorCode:"",errorMessage:"",response:{}},n={};return e.hasOwnProperty("sourceAPI")?(t.status=e.sourceAPI.status,t.url=e.sourceAPI.url,t.sourceId=e.sourceAPI.response.sourceId,t.errorCode=e.sourceAPI.response.errorCode,t.errorMessage=e.sourceAPI.response.errorMessage,t.response=e.sourceAPI.response,e.sourceAPI.response.hasOwnProperty("errorInstructors")&&(n=e.sourceAPI.response.errorInstructors)):(t.status=e.status,t.url=e.url,e.hasOwnProperty("error")&&(t.sourceId=e.error.sourceId,t.errorCode=e.error.errorCode,t.errorMessage=e.error.errorMessage,t.response=e.error.response,e.error.hasOwnProperty("errorInstructors")&&(n=e.error.errorInstructors))),n&&n.hasOwnProperty("sourceAPI")&&this.instructorToArray(n,r),r.push(t),r}},{key:"messageAddConfirm",value:function(e,r){var t=e.length,n=this.translateService.currentLang;return e.indexOf("\u3002")===t-1||e.indexOf(".")===t-1?"zh_TW"===n||"zh_CN"===n?e+r:e+" "+r:"zh_TW"===n||"zh_CN"===n?e+"\u3002"+r:e+". "+r}},{key:"handlerProcess",value:function(e){var r=this,t=!1;return"21006"===e.errorCode?(t=!0,this.dwMultiTenant&&this.marketUrl&&"@MARKET_URL@"!==this.marketUrl?this.dwMessageService.confirm({dwTitle:"",dwContent:this.messageAddConfirm(e.errorMessage,this.translateService.instant("dw-login-confirm-iam-21006"))}).subscribe(function(e){e&&window.open(r.marketUrl+"/product-details?goodsCode="+r.dwAppId)}):this.showMessage(e.errorMessage,"")):"21008"===e.errorCode&&(t=!0,this.dwMultiTenant&&this.consoleUrl&&"@CONSOLE_URL@"!==this.consoleUrl?this.dwMessageService.confirm({dwTitle:"",dwContent:this.messageAddConfirm(e.errorMessage,this.translateService.instant("dw-login-confirm-iam-21008"))}).subscribe(function(e){e&&window.open("".concat(r.consoleUrl))}):this.showMessage(e.errorMessage,"")),t}},{key:"errorRule",value:function(e,r){for(var t=[{sourceId:"IAM",errorCode:"20004",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"20005",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"20404",handlerProcess:!1,logout:!1},{sourceId:"IAM",errorCode:"21006",handlerProcess:!0,logout:!1},{sourceId:"IAM",errorCode:"21007",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"21008",handlerProcess:!0,logout:!1},{sourceId:"IAM",errorCode:"21009",handlerProcess:!1,logout:!0},{sourceId:"IAM",errorCode:"21017",handlerProcess:!1,logout:!0}],n=null,s=t.length,o=0;o<s;o++)if(t[o].sourceId===e&&t[o].errorCode===r){n=t[o];break}return n}}]),e}();return e.\u0275fac=function(r){return new(r||e)(i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(h.DwLoggingService),i.\u0275\u0275inject(y),i.\u0275\u0275inject(d.DwSystemConfigService),i.\u0275\u0275inject(c.TranslateService),i.\u0275\u0275inject(M),i.\u0275\u0275inject(d.DW_APP_ID))},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e(i.\u0275\u0275inject(i.INJECTOR),i.\u0275\u0275inject(h.DwLoggingService),i.\u0275\u0275inject(y),i.\u0275\u0275inject(d.DwSystemConfigService),i.\u0275\u0275inject(c.TranslateService),i.\u0275\u0275inject(M),i.\u0275\u0275inject(d.DW_APP_ID))},token:e,providedIn:g}),e}(),I=function(){var e=function(){function e(r){t(this,e),this.httpMessageService=r}return r(e,[{key:"showWarning",value:function(e){return this.httpMessageService.warning(e.description)}}]),e}();return e.\u0275fac=function(r){return new(r||e)(i.\u0275\u0275inject(y))},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e(i.\u0275\u0275inject(y))},token:e,providedIn:g}),e}(),S=function(){var e=function(){function e(r){var n=this;t(this,e),this.configService=r,this.configService.get("apiUrl").subscribe(function(e){return n.apiUrl=e})}return r(e,[{key:"intercept",value:function(e,r){var t=e.url,n=t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")||t.startsWith("assets/");return n||(e=e.clone({url:this.apiUrl+t})),r.handle(e).pipe((0,p.map)(function(e){if(e instanceof f.HttpResponse){var r=e;e=e.clone({body:n?r.body:r.body.response})}return e}))}}]),e}();return e.\u0275fac=function(r){return new(r||e)(i.\u0275\u0275inject(d.DwSystemConfigService))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}(),b=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"handlerError",value:function(e){}}]),e}();return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=i.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:g}),e}(),C=function(){var e=function(){function e(r,n){t(this,e),this.dwHttpRequestUrlService=r,this.dwHttpLoadMaskService=n,this.api="",this.systemHttpError=(0,i.inject)(b),this.http=(0,i.inject)(f.HttpClient),this.dwLoggingService=(0,i.inject)(h.DwLoggingService)}return r(e,[{key:"errorHandler",value:function(e){}},{key:"responseIntercept",value:function(e){return e}},{key:"defaultHeaders",get:function(){return{}}},{key:"defaultParams",get:function(){return{}}},{key:"httpCodec",get:function(){return new f.HttpUrlEncodingCodec}},{key:"setThrowawayHeader",value:function(e){this.throwawayHeader=e}},{key:"newHttpHeaders",value:function(){var e=this,r=new f.HttpHeaders;return Object.keys(this.defaultHeaders).forEach(function(t){r=r.set(t,e.defaultHeaders[t])}),r}},{key:"addDefaultOption",value:function(e){var r,t,n=this,s=e||{};if(r=s.headers instanceof f.HttpHeaders?s.headers:void 0!==s.headers?new f.HttpHeaders(s.headers):this.newHttpHeaders(),void 0!==this.throwawayHeader){var o=this.throwawayHeader;this.throwawayHeader=void 0,Object.keys(o).forEach(function(e){r=r.set(e,o[e])})}return s.params&&(t=s.params instanceof f.HttpParams?s.params:new f.HttpParams({fromObject:s.params,encoder:this.httpCodec})),t=Object.keys(this.defaultParams).reduce(function(e,r){return e.has(r)?e:e.set(r,n.defaultParams[r])},t),{headers:r,observe:s.observe,params:t,body:s.body,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials}}},{key:"requestProcess",value:function(e,r){var t=this,n=this.dwHttpLoadMaskService.showMask(r);return e.pipe((0,p.tap)(function(e){return t.dwHttpLoadMaskService.hideMask(n),t.dwLoggingService.httpErrorCloseMessage(e),e},function(e){t.dwHttpLoadMaskService.hideMask(n),t.systemHttpError.handlerError(e),t.errorHandler(e)}),(0,p.map)(function(e){return t.responseIntercept(e)}))}},{key:"request",value:function(e,r,t){var n=this.addDefaultOption(t),s=this.dwHttpRequestUrlService.getUrl(this.api,r),o=this.http.request(e,s,n);return this.requestProcess(o,t)}},{key:"get",value:function(e,r){var t=this.addDefaultOption(r),n=this.dwHttpRequestUrlService.getUrl(this.api,e),s=this.http.get(n,t);return this.requestProcess(s,r)}},{key:"post",value:function(e,r,t){var n=this.addDefaultOption(t),s=this.dwHttpRequestUrlService.getUrl(this.api,e),o=this.http.post(s,r,n);return this.requestProcess(o,t)}},{key:"put",value:function(e,r,t){var n=this.addDefaultOption(t),s=this.dwHttpRequestUrlService.getUrl(this.api,e),o=this.http.put(s,r,n);return this.requestProcess(o,t)}},{key:"delete",value:function(e,r){var t=this.addDefaultOption(r),n=this.dwHttpRequestUrlService.getUrl(this.api,e),s=this.http.delete(n,t);return this.requestProcess(s,r)}}]),e}();return e.\u0275fac=function(r){return new(r||e)(i.\u0275\u0275inject(w),i.\u0275\u0275inject(M))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}()}}])}();