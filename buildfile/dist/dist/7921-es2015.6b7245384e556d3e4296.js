"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[7921],{51270:function(e,t,r){r.r(t),r.d(t,{DwSsoButtonComponent:function(){return b},DwSsoLoginComponent:function(){return P},DwSsoLoginModule:function(){return C},"\u0275a":function(){return S},"\u0275b":function(){return I}});var n=r(42746),s=r(55245),i=r(83522),o=r(87974),a=r(71049),c=r(47372),l=r(31441),u=r(30469),d=r(32245),h=r(32276),w=r(68521),g=r(12146),p=r(44720),v=r(52161),f=r(85835);function m(e,t){1&e&&(n.\u0275\u0275elementStart(0,"p"),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd()),2&e&&(n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(2,1,"dw-login-signIn")," ...\n"))}const S=o.RouterModule.forChild([]);let I=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=n.\u0275\u0275defineInjector({imports:[[S],o.RouterModule]}),e})(),P=(()=>{class e{constructor(e,t,r,n,s,i,o,c,l,u,d){this.router=e,this.activateRoute=t,this.languageService=r,this.authService=n,this.dwModalService=s,this.dwProgramExecuteService=i,this.issoLogins=o,this._usingTab=c,this.translateService=l,this.dwChangePasswordInfoService=u,this.dwUpdatePasswordModalService=d,this.showMessage=!0,this.subscription=new a.Subscription}ngOnInit(){this.activateRoute.queryParamMap.subscribe(e=>{(0,a.from)(this.issoLogins).pipe((0,c.map)(t=>{const r=t.ssoLogin(e);return r instanceof a.Observable?r:(0,a.of)(r)}),(0,c.mergeAll)(),(0,c.reduce)((e,t)=>e||t,!1)).subscribe(t=>{if(t){const t=e.get("dwProgramId");let r=e.get("routerLink")||"";const n=e.get("dwLang")||"",s=this.filterParams(e);if(n&&this.languageService.setUp(n),t)this.showMessage=!1,this.dwProgramExecuteService.byId(t,s);else{const e=this._getUrlQueryParams(s);e&&(r=r+"?"+e),this.showMessage=!1,this.loginedForwardUrl(r)}}else this.authService.logout()},e=>{let t=!1;e.hasOwnProperty("error")&&e.error.hasOwnProperty("errorMessage")&&e.error.errorMessage&&(t=!0,this.dwModalService.error({dwContent:e.error.errorMessage}).afterClose.subscribe(e=>{this.authService.logout()})),t||this.authService.logout()})})}ngAfterViewInit(){this.subscription.add(this.dwChangePasswordInfoService.openChangePasswordModal$.subscribe(e=>{this.dwModalService.create({dwTitle:this.translateService.instant("dw-default-pw-change-title"),dwClosable:!1,dwMaskClosable:!1,dwFooter:null,dwOnOk:()=>{this.dwUpdatePasswordModalService.open({modalOnCancel:()=>{this.dwChangePasswordInfoService.notActiveChangedStatus()}}).subscribe(e=>{this.dwChangePasswordInfoService.activeChangedStatus()})},dwContent:v.DwChangeDefaultPasswordInfoComponent})}))}ngOnDestroy(){this.subscription.unsubscribe()}filterParams(e){const t={};let r;return e.keys.forEach(n=>{switch(n){case"routerLink":case"userToken":case"dwLang":break;default:r=e.getAll(n),t[n]=r&&r.length>1?r:e.get(n)}}),(0,o.convertToParamMap)(t)}loginedForwardUrl(e){null!==e&&""!==e&&"/"!==e?this.router.navigateByUrl(e):this.dwProgramExecuteService.goHome()}_getUrlQueryParams(e){let t="";const r=[];let n=null;return e.keys.forEach(t=>{n=e.getAll(t),n.forEach(e=>{r.push({key:t,value:e})})}),0===r.length||(t=r.map(e=>encodeURIComponent(e.key)+"="+encodeURIComponent(e.value)).join("&")),t}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275directiveInject(o.Router),n.\u0275\u0275directiveInject(o.ActivatedRoute),n.\u0275\u0275directiveInject(d.DwLanguageService),n.\u0275\u0275directiveInject(h.DwAuthService),n.\u0275\u0275directiveInject(l.DwModalService),n.\u0275\u0275directiveInject(w.DwProgramExecuteService),n.\u0275\u0275directiveInject(u.DW_SSO_LOGIN),n.\u0275\u0275directiveInject(u.DW_USING_TAB),n.\u0275\u0275directiveInject(i.TranslateService),n.\u0275\u0275directiveInject(g.DwChangePasswordInfoService),n.\u0275\u0275directiveInject(p.DwUpdatePasswordModalService))},e.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["app-sso-login"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&n.\u0275\u0275template(0,m,3,3,"p",0),2&e&&n.\u0275\u0275property("ngIf",t.showMessage)},directives:[s.NgIf],pipes:[i.TranslatePipe],styles:[""]}),e})(),b=(()=>{class e{constructor(e){this.ssoService=e}set url(e){this._url=e}get url(){return this._url}set text(e){this._text=e}get text(){return this._text}set newWin(e){this._newWin="string"==typeof e?JSON.parse(e):e}get newWin(){return this._newWin}redirectUrl(){this.ssoService.redirectUrl(this.url,this.newWin,this.otherParams)}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(n.\u0275\u0275directiveInject(f.DwSsoService))},e.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["app-sso-button"]],inputs:{url:"url",text:"text",newWin:"newWin",otherParams:"otherParams"},decls:3,vars:1,consts:[[1,"sso-link"],[3,"click"]],template:function(e,t){1&e&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275elementStart(1,"a",1),n.\u0275\u0275listener("click",function(){return t.redirectUrl()}),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd()),2&e&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.text))},styles:[""]}),e})(),C=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=n.\u0275\u0275defineInjector({imports:[[s.CommonModule,i.TranslateModule,I,v.DwChangeDefaultPasswordInfoModule]]}),e})()}}]);