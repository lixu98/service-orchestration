!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[7646,9832],{87646:function(t,a,r){r.r(a),r.d(a,{CalendarView:function(){return b},DwPlanCalendarColorService:function(){return S},DwPlanCalendarCoreModule:function(){return P},DwPlanCalendarEventManageService:function(){return g},DwPlanCalendarEventRepository:function(){return m},DwPlanCalendarManageService:function(){return k},DwPlanCalendarModalService:function(){return E},DwPlanCalendarPermissionService:function(){return C},DwPlanCalendarRepository:function(){return w},DwPlanCalendarService:function(){return D}});var i,s=r(42746),c=r(78167),l=r(30469),o=r(71049),u=r(47372),d=r(83522),v=r(55245),f=r(32698),p=r.n(f),h=r(52575),y=r(1020),b=((i=b||(b={})).GridMonth="dayGridMonth",i.GridWeek="timeGridWeek",i.GridDay="timeGridDay",i.ListMonth="listMonth",i.ListWeek="listWeek",i.ListDay="listDay",b),w=function(){var t=function(){function t(n,a){e(this,t),this.http=n,this.dwAppId=a}return n(t,[{key:"calendarsCreate",value:function(e){return this.http.post("api/cmc/v2/calendars/create",e)}},{key:"calendarsUpdate",value:function(e){return this.http.post("api/cmc/v2/calendars/update",e)}},{key:"calendarsDelete",value:function(e){return this.http.post("api/cmc/v2/calendars/remove",e)}},{key:"calendarsSubscriptionList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={appIds:[]};return 0===e.length?t.appIds.push(this.dwAppId):t.appIds=JSON.parse(JSON.stringify(e)),this.http.post("api/cmc/v2/calendars/subscription/list",t)}},{key:"calendarsSubscribe",value:function(e){return this.http.post("api/cmc/v2/calendars/subscribe",e)}},{key:"calendarsUnSubscribe",value:function(e){return this.http.post("api/cmc/v2/calendars/unsubscribe",e)}},{key:"getCalendarList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={appIds:[]};return 0===e.length?t.appIds.push(this.dwAppId):t.appIds=JSON.parse(JSON.stringify(e)),this.http.post("api/cmc/v2/calendars/currentuser",t)}},{key:"calendarsHoliday",value:function(e){return this.http.post("api/cmc/v2/calendars/holiday",e)}},{key:"calendarSelected",value:function(e){return this.http.post("api/cmc/v2/calendars/visible",e)}},{key:"calendarDetail",value:function(e){return this.http.post("api/cmc/v2/calendars/detail",e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(c.DwCmcHttpClient),s.\u0275\u0275inject(l.DW_APP_ID))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),m=function(){var t=function(){function t(n){e(this,t),this.http=n}return n(t,[{key:"eventsCreate",value:function(e){return this.http.post("api/cmc/v2/events/create",e)}},{key:"eventsDetail",value:function(e){return this.http.post("api/cmc/v2/events/detail",e)}},{key:"eventsUpdate",value:function(e){return this.http.post("api/cmc/v2/events/update",e)}},{key:"eventsDelete",value:function(e){return this.http.post("api/cmc/v2/events/delete",e)}},{key:"events",value:function(e){return this.http.post("api/cmc/v2/events",e).pipe((0,u.catchError)(function(e,t){return o.Observable.create(function(e){e.next([]),e.complete()})}))}},{key:"eventsUpdateStatus",value:function(e){return this.http.post("api/cmc/v2/events/update/status",e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(c.DwCmcHttpClient))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),S=function(){var t=function(){function t(){e(this,t)}return n(t,[{key:"default",value:function(){return"#039BE5"}},{key:"colorList",value:function(){return["#AD1457","#D81B60","#D50000","#E67C73","#F4511E","#EF6C00","#F09300","#FFCC00","#E4C441","#C0CA33","#7DB342","#33B679","#0B8043","#009688","#039BE5","#4285F4","#3F51B5","#7986CB","#9E69AF","#8E24AA"]}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),C=function(){var t=function(){function t(n){e(this,t),this.translateService=n}return n(t,[{key:"attendeePermissionList",value:function(){return[{key:"EDIT",hasPermission:!1,titleKey:this.translateService.instant("dw-plan-calendar-modify-schedule")},{key:"INVITE",hasPermission:!1,titleKey:this.translateService.instant("dw-plan-calendar-invite-participants")},{key:"VIEW",hasPermission:!1,titleKey:this.translateService.instant("dw-plan-calendar-view-participants-list")}]}},{key:"permission",value:function(e,t){var n={modifyDetail:!1,delete:!1,unsubscribe:!1};return"MANAGE"===e?(n.modifyDetail=!0,t||(n.delete=!0)):n.unsubscribe=!0,n}},{key:"eventPermission",value:function(e,t,n){var a={readDetail:!1,readAttendee:!1,modifyDetail:!1,modifyAttendee:!1,add:!1,delete:!1};switch(e){case"MANAGE":case"EDIT":a.readDetail=!0,a.readAttendee=!0,a.modifyDetail=!0,a.modifyAttendee=!0,a.add=!0,a.delete=!0;break;case"READ_DETAIL":a.readDetail=!0,a.readAttendee=!0}return"CONFIRMED"===n?(a.readDetail=!0,t.forEach(function(e){switch(e){case"EDIT":a.readDetail=!0,a.readAttendee=!0,a.modifyDetail=!0,a.modifyAttendee=!0;break;case"INVITE":a.readDetail=!0,a.readAttendee=!0,a.modifyAttendee=!0;break;case"VIEW":a.readDetail=!0}})):"TENTATIVE"===n&&(a.readDetail=!0),a}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(d.TranslateService))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),k=function(){var t=function(){function t(n,a){e(this,t),this.dwPlanCalendarRepository=n,this.dwPlanCalendarPermissionService=a}return n(t,[{key:"add",value:function(e){return this.dwPlanCalendarRepository.calendarsCreate(e)}},{key:"update",value:function(e){return this.dwPlanCalendarRepository.calendarsUpdate(e)}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.dwPlanCalendarRepository.calendarsDelete({calendarSids:e})}},{key:"getSubscriptionList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.dwPlanCalendarRepository.calendarsSubscriptionList(e)}},{key:"calendarsSubscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.dwPlanCalendarRepository.calendarsSubscribe({calendarSids:e})}},{key:"calendarsUnSubscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.dwPlanCalendarRepository.calendarsUnSubscribe({calendarSids:e})}},{key:"getCalendarList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.dwPlanCalendarRepository.getCalendarList(t).pipe((0,u.map)(function(t){return t.forEach(function(t){var n=e.dwPlanCalendarPermissionService.permission(t.attendeePermission,t.defaultCal);t.modifyDetail=n.modifyDetail,t.delete=n.delete,t.unsubscribe=n.unsubscribe}),t}))}},{key:"calendarSelected",value:function(e,t){return this.dwPlanCalendarRepository.calendarSelected([{sid:e,visible:t}])}},{key:"calendarDetail",value:function(e){return this.dwPlanCalendarRepository.calendarDetail({sid:e})}},{key:"getBelongCalenars",value:function(){var e=this;return o.Observable.create(function(t){e.getCalendarList().subscribe(function(e){var n=(e||[]).filter(function(e){return"MANAGE"===e.attendeePermission||"EDIT"===e.attendeePermission});t.next(n),t.complete()},function(e){t.next([]),t.complete()})})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(w),s.\u0275\u0275inject(C))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),g=function(){var t=function(){function t(n,a){e(this,t),this.dwPlanCalendarEventRepository=n,this.translateService=a}return n(t,[{key:"add",value:function(e){return this.dwPlanCalendarEventRepository.eventsCreate(e)}},{key:"eventsDetail",value:function(e){return this.dwPlanCalendarEventRepository.eventsDetail(e)}},{key:"update",value:function(e){return this.dwPlanCalendarEventRepository.eventsUpdate(e)}},{key:"delete",value:function(e){return this.dwPlanCalendarEventRepository.eventsDelete(e)}},{key:"events",value:function(e,t,n){var a=this,r={calendarSids:n,startTime:p()(e,"yyyy-MM-dd HH:mm:ss"),endTime:p()(t,"yyyy-MM-dd HH:mm:ss")};return this.dwPlanCalendarEventRepository.events(r).pipe((0,u.map)(function(e){var t=[];return e.forEach(function(e){e.events.forEach(function(n){var r=n.summary;r||(r=a.translateService.instant("dw-plan-calendar-view-busy"));var i={calendarSid:e.calendarSid,title:r,start:n.startDatetime,end:n.endDatetime,allDay:n.allDay,classNames:n.eventStatus?[n.eventStatus.toLowerCase()]:[],extendedProps:Object.assign({},n)};"TENTATIVE"!==n.eventStatus&&(i.color=n.color),new Date(n.startDatetime),new Date(n.endDatetime),i.end.endsWith("23:59:59")&&(i.end=new Date(new Date(n.endDatetime).setSeconds(60))),i.allDay||delete i.color,t.push(i)})}),t}))}},{key:"eventsUpdateStatus",value:function(e,t){return this.dwPlanCalendarEventRepository.eventsUpdateStatus({eventSid:e,status:t})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(m),s.\u0275\u0275inject(d.TranslateService))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),D=function(){var t=function(){function t(n,a,r){e(this,t),this.datePipe=n,this.planCalendarManageService=a,this.planCalendarEventManageService=r,this.calendars=new o.Subject,this.visibleRangeSubject$=new o.BehaviorSubject(null),this.calendarList=[],this.calendarListSubject$=new o.BehaviorSubject([]),this.eventsSubject$=new o.BehaviorSubject([]),this.viewChange$=new o.BehaviorSubject(b.GridMonth),this.todayEventEmitter=new s.EventEmitter,this.nextEventEmitter=new s.EventEmitter,this.previousEventEmitter=new s.EventEmitter}return n(t,[{key:"dateTimeToString",value:function(e){return this.datePipe.transform(e,"yyyy-MM-dd HH:mm:ss")}},{key:"allDayTime",value:function(e,t,n){var a={startDatetime:new Date(t),endDatetime:new Date(n)};return e&&(a.startDatetime=new Date(this.datePipe.transform(t,"yyyy-MM-dd")+" 00:00:00"),a.endDatetime=new Date(this.datePipe.transform(n,"yyyy-MM-dd")+" 23:59:59")),a}},{key:"setVisibleRange",value:function(e){this.visibleRange=e,this.visibleRangeSubject$.next(this.visibleRange),this.viewChange()}},{key:"getVisibleRange",value:function(){return this.visibleRangeSubject$.asObservable().pipe((0,u.filter)(function(e){return null!==e}),(0,u.distinctUntilChanged)())}},{key:"resetViewCalendarList",value:function(){var e=this;this.planCalendarManageService.getCalendarList().subscribe(function(t){e.setViewCalendarList(t)})}},{key:"setViewCalendarList",value:function(e){this.calendarList=JSON.parse(JSON.stringify(e)),this.calendarListSubject$.next(this.calendarList),this.viewChange()}},{key:"getViewCalendarList",value:function(){return this.calendarListSubject$.asObservable().pipe((0,u.filter)(function(e){return null!==e}),(0,u.distinctUntilChanged)())}},{key:"calendarVisible",value:function(e,t){var n=this;if(e){for(var a=JSON.parse(JSON.stringify(this.calendarList)),r=a.length,i=0;i<r;i++)if(a[i].sid===e){t&&a[i].visible!==t&&(a[i].visible=t);break}this.planCalendarManageService.calendarSelected(e,t).subscribe(function(e){n.setViewCalendarList(a)})}}},{key:"viewChange",value:function(){var e=this,t=[];this.visibleRange?(this.calendarList.forEach(function(e){e.visible&&t.push(e.sid)}),this.planCalendarEventManageService.events(this.visibleRange.activeStart,this.visibleRange.activeEnd,t).subscribe(function(t){e.eventsSubject$.next(t)})):this.eventsSubject$.next([])}},{key:"getViewEvents",value:function(){return this.eventsSubject$.asObservable().pipe((0,u.distinctUntilChanged)())}},{key:"changeView",value:function(e){this.viewChange$.next(e)}},{key:"today",value:function(){this.todayEventEmitter.emit()}},{key:"next",value:function(){this.nextEventEmitter.emit()}},{key:"previous",value:function(){this.previousEventEmitter.emit()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(v.DatePipe),s.\u0275\u0275inject(k),s.\u0275\u0275inject(g))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),E=function(){var t=function(){function t(n,a,r,i,s){e(this,t),this.dwPlanCalendarService=n,this.planCalendarManageService=a,this.dwPlanCalendarEventManageService=r,this.translateService=i,this.dwMessageService=s}return n(t,[{key:"calendarAddOnOk",value:function(e){var t=this;return o.Observable.create(function(n){t.dwPlanCalendarService.resetViewCalendarList(),n.next(e),n.complete()})}},{key:"calendarModifyOnOk",value:function(e){var t=this;return o.Observable.create(function(n){t.dwPlanCalendarService.resetViewCalendarList(),n.next(e),n.complete()})}},{key:"calendarDelete",value:function(e){var t=this;return o.Observable.create(function(n){t.dwMessageService.confirm({dwTitle:t.translateService.instant("dw-msg-confirm-delete",{value1:e.name}),dwContent:t.translateService.instant("dw-plan-calendar-remove-tips",{calendarName:e.name})}).subscribe(function(a){a?t.planCalendarManageService.delete([e.sid]).subscribe(function(e){t.dwPlanCalendarService.resetViewCalendarList(),n.next("ok"),n.complete()},function(a){if(a.error.hasOwnProperty("dwHttpErrorResponse")){var r="";a.error.message?r=a.error.message:a.error.dwHttpErrorResponse.errorStatusMessage&&(r=a.error.dwHttpErrorResponse.errorStatusMessage),t.dwMessageService.error(null,{dwTitle:e.name,dwContent:r}).subscribe(function(e){n.next({error:a}),n.complete()})}else n.next({error:a}),n.complete()}):(n.next("cancel"),n.complete())})})}},{key:"calendarSubscribeOnOk",value:function(e){var t=this;return o.Observable.create(function(n){t.dwPlanCalendarService.resetViewCalendarList(),n.next(e),n.complete()})}},{key:"calendarUnsubscribe",value:function(e){var t=this;return o.Observable.create(function(n){t.dwMessageService.confirm({dwTitle:t.translateService.instant("dw-plan-calendar-msg-confirm-unsubscribe"),dwContent:t.translateService.instant("dw-plan-calendar-unsubscribe-tips",{calendarName:e.name})}).subscribe(function(a){a?t.planCalendarManageService.calendarsUnSubscribe([e.sid]).subscribe(function(e){t.dwPlanCalendarService.resetViewCalendarList(),n.next("ok"),n.complete()},function(a){if(a.error.hasOwnProperty("dwHttpErrorResponse")){var r="";a.error.message?r=a.error.message:a.error.dwHttpErrorResponse.errorStatusMessage&&(r=a.error.dwHttpErrorResponse.errorStatusMessage),t.dwMessageService.error(null,{dwTitle:e.name,dwContent:r}).subscribe(function(e){n.next({error:a}),n.complete()})}else n.next({error:a}),n.complete()}):(n.next("cancel"),n.complete())})})}},{key:"calendarEventAddOnOk",value:function(e){var t=this;return o.Observable.create(function(n){var a={calendarSid:null,isUpdate:!1};e.hasOwnProperty("returnData")&&((a=Object.assign({},e.returnData)).calendarSid?t.dwPlanCalendarService.calendarVisible(a.calendarSid,!0):t.dwPlanCalendarService.viewChange()),e.returnData=a,n.next(e),n.complete()})}},{key:"calendarEventEditOnOk",value:function(e){var t=this;return o.Observable.create(function(n){var a={calendarSid:null,isUpdate:!1};e.hasOwnProperty("returnData")&&((a=Object.assign({},e.returnData)).calendarSid?t.dwPlanCalendarService.calendarVisible(a.calendarSid,!0):t.dwPlanCalendarService.viewChange()),e.returnData=a,n.next(e),n.complete()})}},{key:"calendarEventDetailOnOk",value:function(e,t){if(e.hasOwnProperty("returnData")){var n=Object.assign({},e.returnData);n.calendarSid&&n.calendarSid!==t.calendarSid?this.dwPlanCalendarService.calendarVisible(n.calendarSid,!0):this.dwPlanCalendarService.viewChange()}}},{key:"calendarEventDelete",value:function(e,t){var n=this;return o.Observable.create(function(a){n.dwMessageService.confirm({dwTitle:n.translateService.instant("dw-msg-confirm-delete",{value1:t}),dwContent:""}).subscribe(function(r){r?n.dwPlanCalendarEventManageService.delete({eventSid:e}).subscribe(function(e){a.next("ok"),a.complete()},function(e){if(e.error.hasOwnProperty("dwHttpErrorResponse")){var r="";e.error.message?r=e.error.message:e.error.dwHttpErrorResponse.errorStatusMessage&&(r=e.error.dwHttpErrorResponse.errorStatusMessage),n.dwMessageService.error(null,{dwTitle:t,dwContent:r}).subscribe(function(t){a.next({error:e}),a.complete()})}else a.next({error:e}),a.complete()}):(a.next("cancel"),a.complete())})})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.\u0275\u0275inject(D),s.\u0275\u0275inject(k),s.\u0275\u0275inject(g),s.\u0275\u0275inject(d.TranslateService),s.\u0275\u0275inject(h.DwHttpMessageService))},t.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),P=function(){var t=function(){function t(){e(this,t)}return n(t,null,[{key:"forChild",value:function(){return{ngModule:t,providers:[S,D,E,w,m,C,k,g]}}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=s.\u0275\u0275defineInjector({providers:[],imports:[[v.CommonModule,y.FormsModule,y.ReactiveFormsModule,d.TranslateModule]]}),t}()}}])}();