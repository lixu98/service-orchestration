!function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[7999],{4186:function(e,i,r){r.r(i),r.d(i,{DW_AUTH_TOKEN:function(){return b},DW_AUTH_TOKEN_FACTORY:function(){return S},DwActionAuthorizedService:function(){return j},DwAuthFunctionPermissionRepository:function(){return g},DwAuthGuardService:function(){return y},DwAuthModule:function(){return v},DwAuthPermissionInfoService:function(){return p},DwAuthService:function(){return k},DwAuthorizedService:function(){return w}});var o,c=r(42746),u=r(71049),s=r(20033),a=r(55245),h=r(47372),f=r(66800),l=r(87974),d=r(30469),v=((o=t(function e(){n(this,e)})).\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=c.\u0275\u0275defineInjector({imports:[[a.CommonModule]]}),o),g=function(){var e=function(){function e(t){n(this,e),this.dwOperationInfoListService=t}return t(e,[{key:"getFunctionPermissionAll",value:function(){var e=this;return u.Observable.create(function(t){e.dwOperationInfoListService.operationListMap$.subscribe(function(e){var n={data:[]};Object.keys(e).forEach(function(t){var i=e[t],r={code:t,page:[],action:[]};i.hasOwnProperty("page")&&i.page.forEach(function(e){r.page.push({id:e.id,restriction:"allow"})}),i.hasOwnProperty("action")&&i.action.forEach(function(e){r.action.push({id:e.id,restriction:"allow"})}),n.data.push(r)}),t.next(n),t.complete()})})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.\u0275\u0275inject(s.DwOperationInfoListService))},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e(c.\u0275\u0275inject(s.DwOperationInfoListService))},token:e,providedIn:v}),e}(),p=function(){var e=function(){function e(t,i){var r=this;n(this,e),this.dwTenantService=t,this.dwAuthFunctionPermissionRepository=i,this.isPermissionInit=!1,this.authorizedList=null,this.authorizedListSubject=new u.BehaviorSubject(this.authorizedList),this.dwTenantService.isTokenValid$.subscribe(function(e){e?r.isPermissionInit||(r.isPermissionInit=!0,r.authorizedList={},r.dwAuthFunctionPermissionRepository.getFunctionPermissionAll().subscribe(function(e){var t=e.data;t.push({code:"home",page:[],action:[]}),t.forEach(function(e){e.hasOwnProperty("action")&&e.action.forEach(function(e){""===e&&(e="disabled")});var t={programId:e.code,action:e.action?e.action:[]};if(r.authorizedList[e.code]=t,e.hasOwnProperty("page"))for(var n=e.page.length,i=0;i<n;i++)"allow"===e.page[i].restriction&&(r.authorizedList[e.page[i].id]={programId:t.programId,action:[]})}),r.authorizedListSubject.next(r.authorizedList)},function(e){console.log(e),r.authorizedList=void 0,r.authorizedListSubject.next(r.authorizedList)})):r.clearPermissTree()},function(e){console.log(e),r.clearPermissTree()})}return t(e,[{key:"authorizedList$",get:function(){return this.authorizedListSubject.asObservable().pipe((0,h.filter)(function(e){return null!==e}),(0,h.distinctUntilChanged)())}},{key:"clearPermissTree",value:function(){this.isPermissionInit=!1,this.authorizedList=null,this.authorizedListSubject.next(this.authorizedList)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.\u0275\u0275inject(f.DwTenantService),c.\u0275\u0275inject(g))},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e(c.\u0275\u0275inject(f.DwTenantService),c.\u0275\u0275inject(g))},token:e,providedIn:v}),e}(),w=function(){var e=function(){function e(){n(this,e)}return t(e,[{key:"canLoad",value:function(e){return!0}},{key:"canActivate",value:function(e){return!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e},token:e,providedIn:v}),e}();function S(){return{}}var b=new c.InjectionToken("DW_AUTH_TOKEN",{providedIn:v,factory:S}),k=function(){var e=function(){function e(t,i,r,o,c){n(this,e),this.router=t,this.userService=i,this.authToken=r,this.defaultLogin=o,this.dwTenantService=c,this.loginSuccess="boolean"==typeof this.userService.getUser("isLoggedin")?this.userService.getUser("isLoggedin"):null,this.loginSubject=new u.BehaviorSubject(this.loginSuccess),this.setAuthToken({})}return t(e,[{key:"isLoggedIn$",get:function(){return this.loginSubject.asObservable().pipe((0,h.filter)(function(e){return null!==e}),(0,h.distinctUntilChanged)())}},{key:"isLoggedIn",get:function(){return this.loginSuccess}},{key:"isAuthenticated",value:function(e){var t=e.url,n="boolean"==typeof this.userService.getUser("isLoggedin")?this.userService.getUser("isLoggedin"):null;return n||this.router.navigate([this.defaultLogin],{queryParams:{returnUrl:t}}),n}},{key:"login",value:function(e){var t=this,n={success:!0,description:"",currTenantList:[]};return new u.Observable(function(i){t.setLogined({userId:e.userId,userName:e.userId,token:""}),t.dwTenantService.setTokenValid(!0),i.next(n),i.complete()})}},{key:"logout",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0!==this.userService.getUser("token")?(this.loginSuccess=!1,this.loginSubject.next(this.loginSuccess),this.userService.clearUser(),this.authToken.token="",!0===e&&this.router.navigateByUrl(this.defaultLogin)):this.router.navigateByUrl(this.defaultLogin)}},{key:"setAuthToken",value:function(e){Object.keys(e).length>0&&this.userService.setUserInfo(e),this.authToken.token=this.userService.getUser("token")?this.userService.getUser("token"):""}},{key:"setLogined",value:function(e){this.userService.setUserInfo({isLoggedin:!0}),this.setAuthToken(e),this.loginSuccess=!0,this.loginSubject.next(this.loginSuccess)}},{key:"tokenRefreshTenant",value:function(e){return console.error("\u8acb\u6ce8\u610f\uff1aDwTenantService.tokenRefreshTenant() \u53d6\u4ee3 DwAuthService.tokenRefreshTenant()"),new u.Observable(function(e){e.next({}),e.complete()})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.\u0275\u0275inject(l.Router),c.\u0275\u0275inject(f.DwUserService),c.\u0275\u0275inject(b),c.\u0275\u0275inject(d.LONIG_DEFAULT),c.\u0275\u0275inject(f.DwTenantService))},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e(c.\u0275\u0275inject(l.Router),c.\u0275\u0275inject(f.DwUserService),c.\u0275\u0275inject(b),c.\u0275\u0275inject(d.LONIG_DEFAULT),c.\u0275\u0275inject(f.DwTenantService))},token:e,providedIn:v}),e}(),y=function(){var e=function(){function e(t,i){n(this,e),this.authService=t,this.authorizedService=i}return t(e,[{key:"canLoad",value:function(e){return this.authorizedService.canLoad(e.path)}},{key:"canActivateChild",value:function(e,t){return this.auth(e,t)}},{key:"canActivate",value:function(e,t){return this.auth(e,t)}},{key:"auth",value:function(e,t){return!!this.authService.isAuthenticated(t)&&this.authorizedService.canActivate(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.\u0275\u0275inject(k),c.\u0275\u0275inject(w))},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e(c.\u0275\u0275inject(k),c.\u0275\u0275inject(w))},token:e,providedIn:v}),e}(),j=function(){var e=function(){function e(t){n(this,e),this.authPermissionInfoService=t}return t(e,[{key:"getActionAuth",value:function(e,t){var n=this;return u.Observable.create(function(i){var r=null;n.authPermissionInfoService.authorizedList$.pipe().subscribe(function(n){var o=n,c=o[e];if(c){var u=[];if(c.programId===e)u=c.action;else{var s=o[c.programId];s&&(u=s.action)}1===(u=u.filter(function(e){return e.id===t})).length?u[0].hasOwnProperty("id")&&u[0].hasOwnProperty("restriction")&&(r=u[0].restriction):o[t]&&(r="allow")}i.next(r),i.complete()},function(n){i.complete(),console.log(e+"("+t+"):"),console.log(n)})})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.\u0275\u0275inject(p))},e.\u0275prov=c.\u0275\u0275defineInjectable({factory:function(){return new e(c.\u0275\u0275inject(p))},token:e,providedIn:v}),e}()}}])}();