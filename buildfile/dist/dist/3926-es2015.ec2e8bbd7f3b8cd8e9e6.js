"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[3926],{41649:function(e,t,s){s.r(t),s.d(t,{DwManualUpdateCheckService:function(){return p},DwServiceWorkerModule:function(){return E},DwServiceWorkerUpdateService:function(){return u},DwSwUpdateContentComponent:function(){return d},SERVICE_WORKER_NEW_UPDATE_CHECKER:function(){return v},SERVICE_WORK_AUTO_REFRESH:function(){return m},SERVICE_WORK_ENABLE:function(){return w},SERVICE_WORK_INTERVAL:function(){return f},initServiceWorker:function(){return R},newUpdaterFactory:function(){return S}});var i=s(42746),n=s(30052),r=s(71049),a=s(83522),o=s(52575),c=s(32245),h=s(47372),l=s(99487);let u=(()=>{class e{constructor(e,t,s,i){this.updates=e,this.injector=t,this.languageService=s,this.translate=i,this.notifyInterval=3e5,this.autoRefresh=!1,this.stop$=new r.Subject}initialize(e,t,s){this.autoRefresh=s,t&&navigator&&navigator.serviceWorker&&navigator.serviceWorker.register("/ngsw-worker.js"),this.modalService=this.injector.get(o.DwHttpMessageService),this.updates.isEnabled&&(this.updates.available.subscribe(e=>{console.log("\u6709\u65b0\u7248\u672c\uff0c\u5c07\u6703\u9032\u884c\u91cd\u65b0\u6574\u7406"),this.updates.activateUpdate().then(()=>{console.log("\u66f4\u65b0\u5b8c\u6210"),this.languageService.language$.subscribe(e=>{e&&this.notifyRefresh()})}),this.updates.activated.subscribe(e=>{console.log("activated finish")},e=>{console.log("updates.activated.error",e)})}),(0,r.interval)(e).pipe((0,h.takeUntil)(this.stop$)).subscribe(()=>{this.updates.checkForUpdate().then(e=>{},e=>{console.log("Inside Interval updates.checkForUpdate() err =",e)})}))}notifyRefresh(){this.autoRefresh?this.refresh():this.modal||(this.modal=this.modalService.create({dwContent:this.translate.instant("dw-detect-update-finished"),dwClassName:"update-refresh-modal",dwMaskClosable:!1,dwClosable:!1,dwOkText:this.translate.instant("dw-update-refresh"),dwOkType:"primary",dwCancelText:this.translate.instant("dw-update-refresh-wait")}),this.modal.subscribe(e=>{e?this.refresh():this.timeout$=setTimeout(()=>{this.notifyRefresh()},this.notifyInterval),this.modal=null}))}refresh(){document.location.reload()}stop(){this.stop$.next(),this.stop$.complete(),clearTimeout(this.timeout$)}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275inject(n.SwUpdate,8),i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(c.DwLanguageService),i.\u0275\u0275inject(a.TranslateService))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})(),d=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["dw-update-content"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),p=(()=>{class e{constructor(e,t,s,i,n){this.updates=e,this.injector=t,this.languageService=s,this.translate=i,this.httpClient=n,this.swJson="assets/sw.json",this.notifyInterval=3e5,this.autoRefresh=!1,this.timestamp=null,this.stop$=new r.Subject}initialize(e,t,s){this.autoRefresh=s,this.millisecond=e,t&&(this.modalService=this.injector.get(o.DwHttpMessageService),this.checkForUpdate().then(),this.start())}start(){(0,r.interval)(this.millisecond).pipe((0,h.takeUntil)(this.stop$)).subscribe(()=>{this.checkForUpdate().then(e=>{e&&this.notifyRefresh()},e=>{console.log("Inside Interval checkForUpdate() err =",e)})})}checkForUpdate(){return new Promise(e=>{this.httpClient.get(`${this.swJson}?ngsw-bypass=${(new Date).getTime()}`).pipe((0,h.catchError)(e=>(0,r.of)({timestamp:this.timestamp}))).subscribe(t=>{let s=!1;null===this.timestamp?this.timestamp=t.timestamp:this.timestamp!==t.timestamp&&(s=!0),e(s)})})}notifyRefresh(){this.autoRefresh?this.refresh():this.modal||(this.modal=this.modalService.create({dwContent:this.translate.instant("dw-detect-update-finished"),dwClassName:"update-refresh-modal",dwMaskClosable:!1,dwClosable:!1,dwOkText:this.translate.instant("dw-update-refresh"),dwOkType:"primary",dwCancelText:this.translate.instant("dw-update-refresh-wait")}),this.modal.subscribe(e=>{e?this.refresh():this.timeout$=setTimeout(()=>{this.notifyRefresh()},this.notifyInterval),this.modal=null}))}refresh(){document.location.reload()}stop(){this.stop$.next(),this.stop$.complete(),clearTimeout(this.timeout$)}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275inject(n.SwUpdate),i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(c.DwLanguageService),i.\u0275\u0275inject(a.TranslateService),i.\u0275\u0275inject(l.HttpClient))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e})();const f=new i.InjectionToken("SERVICE_WORK_INTERVAL"),w=new i.InjectionToken("SERVICE_WORK_ENABLE"),m=new i.InjectionToken("SERVICE_WORK_AUTO_REFRESH"),v=new i.InjectionToken("SERVICE_WORKER_NEW_UPDATER");function R(e,t,s,i){return()=>{t&&(null==i||i.initialize(e,t,s))}}function S(e,t,s,i,n,r){return e?r:new u(t,s,i,n)}let E=(()=>{class e{static forRoot(t,s,r=!1){return{ngModule:e,providers:[...n.ServiceWorkerModule.register("/ngsw-worker.js",{enabled:s}).providers,u,p,{provide:v,useValue:!0},{provide:u,useFactory:S,deps:[v,n.SwUpdate,i.Injector,c.DwLanguageService,a.TranslateService,p]},{provide:f,useValue:t},{provide:w,useValue:s},{provide:m,useValue:r},{provide:i.APP_INITIALIZER,useFactory:R,deps:[f,w,m,u],multi:!0}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=i.\u0275\u0275defineInjector({imports:[[],n.ServiceWorkerModule]}),e})()}}]);