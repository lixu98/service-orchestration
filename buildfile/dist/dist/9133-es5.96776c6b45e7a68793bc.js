!function(){"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[9133],{27848:function(n,r,o){o.r(r),o.d(r,{DW_ROUTER_KEY_COOKIE_DOMAIN:function(){return w},DW_ROUTER_KEY_COOKIE_PATH:function(){return E},DW_ROUTER_KEY_HEADER_IGNORE_APIS:function(){return C},DW_ROUTER_KEY_REFRESH_PAGE:function(){return k},DwRouterKeyConfuseModalComponent:function(){return K},DwRouterKeyConfuseModalResult:function(){return S},DwRouterKeyConfuseModalService:function(){return _},DwRouterKeyConfuseWarnBarComponent:function(){return j},DwRouterKeyHttpHeaderInterceptor:function(){return D},DwRouterKeyModule:function(){return x},DwRouterKeyService:function(){return O},deleteRouterKey:function(){return I},getRouterKey:function(){return b},setRouterKey:function(){return R},"\u0275a":function(){return T}});var i,a=o(42746),c=o(66800),u=o(32276),s=o(87974),l=o(99487),f=o(83522),d=o(16612),h=o(30469),p=o(51855),v=o(71049),g=o(10952),y=o(47372),m=o(78597),k=new a.InjectionToken("DW_ROUTER_KEY_REFRESH_PAGE"),E=new a.InjectionToken("DW_ROUTER_KEY_COOKIE_PATH"),w=new a.InjectionToken("DW_ROUTER_KEY_COOKIE_DOMAIN"),C=new a.InjectionToken("DW_ROUTER_KEY_HEADER_IGNORE"),S=((i=S||(S={})).REFRESH="refresh",i.CONTINUE="continue",i.CLOSE="close",S);function b(){var e=document.cookie.split(";").find(function(e){return e.trim().startsWith("routerKey=")});return e?e.split("=").pop():void 0}function R(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t?" domain=".concat(t,";"):"";document.cookie="routerKey=".concat(e,"; expires=; path=").concat(n,";")+r,document.cookie="routerKey=".concat(e,"; path=").concat(n,";")+r}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.cookie="routerKey=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=".concat(e,";")+(n?" domain=".concat(n,";"):"")}var O=function(){var n=function(){function n(t,r,o,i,a,c,u){var s=this;e(this,n),this.authService=t,this.userService=r,this.tenantService=o,this.refresh=i,this.cookiePath=a,this.cookieDomain=c,this.route=u,this.tenantService.isTokenValid$.subscribe(function(e){if(e){var n=r.getUser("tenantId");b()!==n&&(R(r.getUser("tenantId"),s.cookiePath,s.cookieDomain),s.reloadPage())}else b()&&(I(s.cookiePath,s.cookieDomain),s.reloadPage())})}return t(n,[{key:"reloadPage",value:function(){var e,n=null===(e=this.route.snapshot)||void 0===e?void 0:e.queryParams,t=(null==n?void 0:n.routerLink)||(null==n?void 0:n.returnUrl)||"/";window.location.href=t.startsWith("/")?t:"/"+t}}]),n}();return n.\u0275fac=function(e){return new(e||n)(a.\u0275\u0275inject(u.DwAuthService),a.\u0275\u0275inject(c.DwUserService),a.\u0275\u0275inject(c.DwTenantService),a.\u0275\u0275inject(k),a.\u0275\u0275inject(E),a.\u0275\u0275inject(w),a.\u0275\u0275inject(s.ActivatedRoute))},n.\u0275prov=a.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),K=function(){var n=function(){function n(t){e(this,n),this.swUpdater=t,this.afterClose=new v.Subject}return t(n,[{key:"ngOnInit",value:function(){this.swUpdater&&this.swUpdater.stop()}},{key:"continue",value:function(){this.afterClose.next(S.CONTINUE),this.afterClose.complete()}},{key:"refresh",value:function(){this.afterClose.next(S.REFRESH),this.afterClose.complete()}},{key:"close",value:function(){this.afterClose.next(S.CLOSE),this.afterClose.complete()}}]),n}();return n.\u0275fac=function(e){return new(e||n)(a.\u0275\u0275directiveInject(p.DwServiceWorkerUpdateService,8))},n.\u0275cmp=a.\u0275\u0275defineComponent({type:n,selectors:[["dw-router-key-confuse-modal"]],decls:14,vars:6,consts:[[1,"router-key-modal"],[1,"title"],[2,"font-size","24px","color","red"],["viewBox","64 64 896 896","focusable","false","fill","currentColor","width","1em","height","1em","data-icon","exclamation-circle","aria-hidden","true"],["d","M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512\n             64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"],["d","M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4\n              0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"],[1,"body"],[1,"footer"],[3,"click"]],template:function(e,n){1&e&&(a.\u0275\u0275elementStart(0,"div",0),a.\u0275\u0275elementStart(1,"div",1),a.\u0275\u0275elementStart(2,"i",2),a.\u0275\u0275namespaceSVG(),a.\u0275\u0275elementStart(3,"svg",3),a.\u0275\u0275element(4,"path",4),a.\u0275\u0275element(5,"path",5),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275namespaceHTML(),a.\u0275\u0275elementStart(6,"div",6),a.\u0275\u0275elementStart(7,"h3"),a.\u0275\u0275text(8),a.\u0275\u0275pipe(9,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(10,"div",7),a.\u0275\u0275elementStart(11,"button",8),a.\u0275\u0275listener("click",function(){return n.continue()}),a.\u0275\u0275text(12),a.\u0275\u0275pipe(13,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e&&(a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(9,2,"dw-router-key-confuse-message")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(13,4,"dw-router-key-confuse-continue")))},pipes:[f.TranslatePipe],styles:["\n    .router-key-modal-backdrop {\n      background: #000;\n      opacity: 0.65 !important;\n    }\n    .router-key-modal {\n      width: 500px;\n      background-color: white;\n      border-radius: 5px;\n    }\n    .router-key-modal .body,\n    .router-key-modal .footer{\n      padding: 10px;\n    }\n    .router-key-modal .title {\n        padding: 5px 10px;\n    }\n    .router-key-modal .body {\n      border-top: 1px solid #eee;\n      border-bottom: 1px solid #eee;\n    }\n    .router-key-modal .body h3 {\n      line-height: 2em;\n    }\n    .router-key-modal .footer {\n      text-align: right;\n    }\n    .router-key-modal .footer button {\n      height: 2.5em;\n      cursor: pointer;\n      color: white;\n      background: red;\n      border: none;\n      border-radius: 3px;\n    }\n    .router-key-overlay-container {\n      height: 100%;\n      z-index: 3000 !important;\n      display: flex;\n      position: absolute;\n      width: 100%;\n    }\n  "],encapsulation:2}),n}(),j=function(){var n=t(function n(){e(this,n)});return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=a.\u0275\u0275defineComponent({type:n,selectors:[["ng-component"]],decls:4,vars:3,consts:[[1,"router-key-confuse-warn-bar"],[1,"message"]],template:function(e,n){1&e&&(a.\u0275\u0275elementStart(0,"div",0),a.\u0275\u0275elementStart(1,"span",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,1,"dw-router-key-confuse-message")))},pipes:[f.TranslatePipe],styles:["\n    .router-key-confuse-warn-bar {\n      text-align: center;\n    }\n    .router-key-confuse-warn-bar .message {\n      background-color: red;\n      padding: 0 10px;\n      color: white;\n    }\n  "],encapsulation:2}),n}(),_=function(){var n=function(){function n(t){e(this,n),this.overlay=t}return t(n,[{key:"open",value:function(){var e=new d.OverlayConfig({positionStrategy:this.overlay.position().global().centerHorizontally().centerVertically(),hasBackdrop:!0,backdropClass:"router-key-modal-backdrop"}),n=this.overlay.create(e);n.hostElement.className="router-key-overlay-container";var t=n.attach(new g.ComponentPortal(K));return t.instance.afterClose.subscribe(function(){n.dispose()}),t.instance}},{key:"showWarningBar",value:function(){this.overlay.create({width:"100%",panelClass:"router-key-warning-bar"}).attach(new g.ComponentPortal(j))}}]),n}();return n.\u0275fac=function(e){return new(e||n)(a.\u0275\u0275inject(d.Overlay))},n.\u0275prov=a.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),T=function(){var n=function(){function n(t,r,o){var i=this;e(this,n),this.injector=t,this.routerKeyConfuseModal=r,this.loggingService=o,this.ignoreConfuse=!1,o&&(this.origHttpError=o.httpError,this.origRuntimeError=o.runtimeError,o.httpError=function(e){i.httpError(e)},o.runtimeError=function(e){i.runtimeError(e)})}return t(n,[{key:"httpError",value:function(e){this.checkRouterKey(),this.loggingService&&this.origHttpError&&this.origHttpError.call(this.loggingService,e)}},{key:"runtimeError",value:function(e){this.checkRouterKey(),this.loggingService&&this.origRuntimeError&&this.origRuntimeError.call(this.loggingService,e)}},{key:"checkRouterKey",value:function(){var e=this;if(this.userInfo||(this.userInfo=this.injector.get(c.DwUserService)),!this.ignoreConfuse){var n=this.userInfo.getUser("tenantId");b()!==n&&this.injector.get(a.NgZone).run(function(){e.routerKeyConfuseModal.open().afterClose.subscribe(function(n){n===S.CONTINUE&&(e.ignoreConfuse=!0,e.routerKeyConfuseModal.showWarningBar())})})}}}]),n}();return n.\u0275fac=function(e){return new(e||n)(a.\u0275\u0275inject(a.Injector),a.\u0275\u0275inject(_),a.\u0275\u0275inject(m.DwLoggingService,8))},n.\u0275prov=a.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),D=function(){var n=function(){function n(t,r,o,i,a,c,u){var s=this;e(this,n),this.configService=t,this.userInfo=r,this.authService=o,this.routerKeyService=i,this.routerKeyConfuseModal=a,this.loggingService=c,this.ignoreApis=u,this.modalOpening=!1,this.ignoreConfuse=!1,this.isLogging=!1,this.configService.getConfig().subscribe(function(e){return s.config=e}),this.authService.isLoggedIn$.subscribe(function(e){s.isLogging=e})}return t(n,[{key:"intercept",value:function(e,n){var t=this,r=!1,o=this.userInfo.getUser("tenantId");return this.isLogging&&(r=b()!==o),this.includes(e.url)||o&&(e=e.clone({setHeaders:{routerKey:o}})),this.ignoreConfuse?n.handle(e):r&&!this.modalOpening?(this.modalOpening=!0,this.routerKeyConfuseModal.open().afterClose.pipe((0,y.tap)(function(e){switch(e){case S.REFRESH:t.authService.logout();break;case S.CONTINUE:t.ignoreConfuse=!0,t.routerKeyConfuseModal.showWarningBar();break;case S.CLOSE:window.close()}}),(0,y.takeWhile)(function(e){return e===S.CONTINUE}),(0,y.concatMap)(function(){return n.handle(e)}))):n.handle(e)}},{key:"includes",value:function(e){if(this.ignoreApis.length>0&&this.config)for(var n=0;n<this.ignoreApis.length;n++)if(e.startsWith(this.config[this.ignoreApis[n]]))return!0;return!1}}]),n}();return n.\u0275fac=function(e){return new(e||n)(a.\u0275\u0275inject(h.DwSystemConfigService),a.\u0275\u0275inject(c.DwUserService),a.\u0275\u0275inject(u.DwAuthService),a.\u0275\u0275inject(O),a.\u0275\u0275inject(_),a.\u0275\u0275inject(T),a.\u0275\u0275inject(C,8))},n.\u0275prov=a.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),x=function(){var n=function(){function n(){e(this,n)}return t(n,null,[{key:"forRoot",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{ngModule:n,providers:[T,O,_,{provide:E,useValue:"/"},{provide:w,useValue:null},{provide:k,useValue:e},{provide:l.HTTP_INTERCEPTORS,useClass:D,multi:!0},{provide:C,useValue:t}]}}}]),n}();return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=a.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=a.\u0275\u0275defineInjector({imports:[[f.TranslateModule,d.OverlayModule]]}),n}()}}])}();