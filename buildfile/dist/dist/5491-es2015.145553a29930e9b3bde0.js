"use strict";(self.webpackChunkassc_crs=self.webpackChunkassc_crs||[]).push([[5491,1414],{35491:function(e,t,n){n.r(t),n.d(t,{DwRoutingTabSetComponent:function(){return P},DwRoutingTabSetModule:function(){return j},TAB_STORED_KEY:function(){return M}});var r=n(55245),i=n(42746),o=n(87974),a=n(71049),s=n(47372),c=n(30469),l=n(66800),u=n(32276),d=n(83174),f=n(29853),m=n(61699),p=n(28396),h=n(1020),b=n(83522),I=n(78169),v=n(85277),g=n(43542),S=n(96677);function w(e,t){if(1&e){const e=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"i",11),i.\u0275\u0275listener("click",function(t){i.\u0275\u0275restoreView(e);const n=i.\u0275\u0275nextContext(2).index;return i.\u0275\u0275nextContext(2).closeTab(n,t)}),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275elementEnd()}2&e&&i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,1,"dw-tab-close"))}function T(e,t){if(1&e&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275element(1,"dw-icon-element",8),i.\u0275\u0275element(2,"dw-program-title",9),i.\u0275\u0275template(3,w,2,3,"i",10),i.\u0275\u0275elementEnd()),2&e){const e=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(1),i.\u0275\u0275property("dwIconClass",e.iconClass),i.\u0275\u0275advance(1),i.\u0275\u0275property("titleKey",e.title)("programId",e.code?e.code:e.id),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",e.canClose||!1!==e.canClose)}}function y(e,t){if(1&e){const e=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"dw-tab",6),i.\u0275\u0275listener("dwClick",function(){const t=i.\u0275\u0275restoreView(e).index;return i.\u0275\u0275nextContext(2).tabClick(t)})("dwSelect",function(){const t=i.\u0275\u0275restoreView(e).$implicit;return i.\u0275\u0275nextContext(2).tabSelected(t)}),i.\u0275\u0275template(2,T,4,4,"ng-template",null,7,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()}if(2&e){const e=i.\u0275\u0275reference(3);i.\u0275\u0275advance(1),i.\u0275\u0275property("dwTitle",e)}}function C(e,t){1&e&&i.\u0275\u0275element(0,"router-outlet")}function x(e,t){if(1&e&&i.\u0275\u0275element(0,"dw-base-iframe",14),2&e){const e=i.\u0275\u0275nextContext(2).$implicit,t=i.\u0275\u0275nextContext(2);i.\u0275\u0275styleProp("display",(null==e?null:e.tabId)===(null==t.currentTabInfo?null:t.currentTabInfo.tabId)?"block":"none"),i.\u0275\u0275property("item",e.item)}}function E(e,t){if(1&e&&i.\u0275\u0275element(0,"dw-base-iframe",14),2&e){const e=i.\u0275\u0275nextContext(2).$implicit;i.\u0275\u0275property("item",e.item)}}function D(e,t){if(1&e&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,x,1,3,"dw-base-iframe",12),i.\u0275\u0275template(2,E,1,1,"dw-base-iframe",13),i.\u0275\u0275elementContainerEnd()),2&e){const e=i.\u0275\u0275nextContext().$implicit,t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",void 0===(null==e?null:e.reload)||!1===(null==e?null:e.reload)),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",void 0!==(null==e?null:e.reload)&&!0===(null==e?null:e.reload)&&(null==e?null:e.tabId)===(null==t.currentTabInfo?null:t.currentTabInfo.tabId))}}function R(e,t){if(1&e&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,D,3,2,"ng-container",0),i.\u0275\u0275elementContainerEnd()),2&e){const e=t.$implicit;i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",e&&("fineReport"===(null==e?null:e.type)||"externalUrl"===(null==e?null:e.type)))}}function k(e,t){if(1&e&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"div"),i.\u0275\u0275elementStart(2,"dw-tabset",2),i.\u0275\u0275template(3,y,4,1,"ng-container",3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"div",4),i.\u0275\u0275elementStart(5,"div",5),i.\u0275\u0275template(6,C,1,0,"router-outlet",0),i.\u0275\u0275template(7,R,2,1,"ng-container",3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),2&e){const e=i.\u0275\u0275nextContext(),t=i.\u0275\u0275reference(2);i.\u0275\u0275advance(2),i.\u0275\u0275property("dwType","card")("dwSelectedIndex",e.selectedIndex)("dwTabBarExtraContent",t),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",e.routeInfos)("ngForTrackBy",e.trackByTabId),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",e.routeInfos.length>0),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",e.routeInfos)("ngForTrackBy",e.trackByTabId)}}function O(e,t){if(1&e){const e=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"i",15),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(e),i.\u0275\u0275nextContext().closeAll()}),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275elementEnd()}2&e&&i.\u0275\u0275propertyInterpolate("title",i.\u0275\u0275pipeBind1(1,1,"dw-tab-close-all"))}const M="TAB_STORED_KEY";let P=(()=>{class e{constructor(e,t,n,r,i,s,c,l,u,d,f,m){this.routeInfoService=e,this.multiOpen=t,this.recursiveMenuService=n,this.router=r,this.tabRouting=i,this.storageService=c,this.doc=l,this.zone=u,this.subscription=new a.Subscription,this.oldIframe=[];let p=null;this.messageHub=m.getHubInstance(),this.differ=s.find(this.routeInfos).create(this.trackByTabId),this.subscription.add(this.routeInfoService.tabSetIndexChanged.subscribe(e=>{setTimeout(()=>{this.selectedIndex=e,this.currentTabInfo=this.routeInfoService.getTabState(this.selectedIndex),this.isStarted=!0,this.currentTabInfo&&this.recursiveMenuService.onSelect(this.currentTabInfo.menuId,this.currentTabInfo.id)})})),this.subscription.add(this.router.events.subscribe(e=>{if(e instanceof o.ActivationStart&&null===p&&e.snapshot.component&&(p=e.snapshot.component),e instanceof o.ActivationEnd&&null===p&&e.snapshot.component&&(p=e.snapshot.component),e instanceof o.NavigationStart&&(this.routeInfoService.tabSetStateArray[this.routeInfoService.previousIndex].scrollTop=this.outletDiv.scrollTop),e instanceof o.NavigationEnd){this.storeTabs(),this.outletDiv.scrollTop=this.routeInfoService.tabSetStateArray[this.routeInfoService.currentIndex].scrollTop||0;const t=this.routeInfoService.tabChangeState;if(t){const n=this.clearParams(e.url);this.routeInfoService.tabRouterChanged.next({currentId:t.currentTabId,previousId:t.previousTabId,currentRouterLink:n,componentType:p,tabChanged:t.tabChanged})}else this.routeInfoService.tabRouterChanged.next(null);p=null}})),this.subscription.add(d.isLoggedIn$.subscribe(e=>{e||this.clearStoredTabs()})),this.subscription.add(f.isTokenValid$.subscribe(e=>{e||this.clearStoredTabs()}))}get hidden(){return 0===this.routeInfos.length}clearParams(e){const t=new o.DefaultUrlSerializer,n=t.parse(e);return this.clearUrlSegmentGroupParams(n.root),n.queryParams={},t.serialize(n)}clearUrlSegmentGroupParams(e){e.segments.forEach(e=>{e.parameters={}}),e.hasChildren()&&Object.keys(e.children).forEach(t=>{this.clearUrlSegmentGroupParams(e.children[t])})}get routeInfos(){return this.routeInfoService.tabSetStateArray}ngOnInit(){this.routeInfoService.createFirstRouteFromCurrentRoute(this.getStoredTabs())}ngAfterViewInit(){const e=this.doc.querySelector(".for-tab-query-class");this.outletDiv=e||this.doc.documentElement||this.doc.body,this.iframes.changes.subscribe(e=>{this._handleReceives(e)}),this.iframes.length>0&&this._handleReceives(this.iframes)}_handleReceives(e){const t=e.toArray(),n=t.filter(e=>-1===this.oldIframe.indexOf(e)),r=this.oldIframe.filter(e=>-1===t.indexOf(e));n.forEach(e=>{if(e.iframe&&e.iframe.nativeElement){const t=new URL(e.iframe.nativeElement.src);this.messageHub.addReceiver(e.iframe.nativeElement.contentWindow,`${t.protocol}//${t.host}`)}else e.iframes.changes.pipe((0,s.first)()).subscribe(e=>{const t=new URL(e.first.nativeElement.src);this.messageHub.addReceiver(e.first.nativeElement.contentWindow,`${t.protocol}//${t.host}`)})}),r.forEach(e=>{e.iframe&&this.messageHub.removeReceiver(e.iframe.nativeElement.contentWindow)}),this.oldIframe=[...t]}closeTab(e,t){return this.routeInfoService.close(e),t.preventDefault(),t.stopPropagation(),!1}tabClick(e){this.routeInfoService.setCurrentIndex(e),this.selectedIndex=e}showKeys(){console.log(this.routeInfos)}ngDoCheck(){const e=this.differ.diff(this.routeInfos);e&&(e.forEachAddedItem(e=>{this.tabRouting.eventSubject.next(new f.DwTabOpen(e.item.tabId,e.item.currentUrl,e.item.id,e.item.module,e.item.type))}),e.forEachRemovedItem(e=>{this.tabRouting.eventSubject.next(new f.DwTabClose(e.item.tabId,e.item.currentUrl,e.item.id,e.item.module,e.item.type))}),this.storeTabs())}ngOnDestroy(){this.subscription.unsubscribe(),this.routeInfoService.destroy()}closeAll(){this.routeInfoService.closeAll()}trackByTabId(e,t){return t.tabId}tabSelected(e){const t=this.routeInfoService.tabSetStateArray[this.routeInfoService.previousIndex];this.tabRouting.eventSubject.next(new f.DwTabFocusout(t.tabId,t.currentUrl,t.id,t.module,t.type)),this.tabRouting.eventSubject.next(new f.DwTabFocusin(e.tabId,e.currentUrl,e.id,e.module,e.type))}getStoredTabs(){const e=this.storageService.get(M);return e?JSON.parse(e):null}clearStoredTabs(){this.storageService.remove(M)}storeTabs(){if(!this.isStarted)return;const e={tabs:[],currentIndex:this.selectedIndex};this.routeInfoService.tabSetStateArray.forEach((t,n)=>{e.tabs.push({id:t.id,tabId:t.tabId,opener:t.opener,lastPath:t.lastPath,menuId:t.menuId,title:t.title,queryParams:t.queryParams,routerLink:t.routerLink,type:t.type,currentUrl:t.currentUrl,defaultOpen:!0,scrollTop:t.scrollTop,canClose:t.canClose,iconClass:t.iconClass})}),this.zone.runOutsideAngular(()=>{setTimeout(()=>this.storageService.set(M,JSON.stringify(e)))})}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275directiveInject(f.DwTabInfoService2),i.\u0275\u0275directiveInject(c.DW_TAB_MULTI_OPEN),i.\u0275\u0275directiveInject(p.DwRecursiveMenuService),i.\u0275\u0275directiveInject(o.Router),i.\u0275\u0275directiveInject(f.DwTabRoutingService),i.\u0275\u0275directiveInject(i.IterableDiffers),i.\u0275\u0275directiveInject(f.DwTabInfoStorageService),i.\u0275\u0275directiveInject(r.DOCUMENT),i.\u0275\u0275directiveInject(i.NgZone),i.\u0275\u0275directiveInject(u.DwAuthService),i.\u0275\u0275directiveInject(l.DwTenantService),i.\u0275\u0275directiveInject(d.DwPostMessageFactoryService))},e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["dw-routing-tabset"]],viewQuery:function(e,t){if(1&e&&i.\u0275\u0275viewQuery(m.DwBaseIframeComponent,5),2&e){let e;i.\u0275\u0275queryRefresh(e=i.\u0275\u0275loadQuery())&&(t.iframes=e)}},hostVars:1,hostBindings:function(e,t){2&e&&i.\u0275\u0275hostProperty("hidden",t.hidden)},decls:3,vars:1,consts:[[4,"ngIf"],["tabBarExtraContent",""],[1,"dw-f-tabset-bar",3,"dwType","dwSelectedIndex","dwTabBarExtraContent"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"dw-f-layout-content"],[1,"dw-f-tab-info-wp"],[3,"dwTitle","dwClick","dwSelect"],["titleTemplate",""],[3,"dwIconClass"],[3,"titleKey","programId"],["dw-icon","","dwType","close","class","tab-close",3,"title","click",4,"ngIf"],["dw-icon","","dwType","close",1,"tab-close",3,"title","click"],[3,"item","display",4,"ngIf"],[3,"item",4,"ngIf"],[3,"item"],["dw-icon","","dwType","",1,"closeall",3,"title","click"]],template:function(e,t){1&e&&(i.\u0275\u0275template(0,k,8,8,"ng-container",0),i.\u0275\u0275template(1,O,2,3,"ng-template",null,1,i.\u0275\u0275templateRefExtractor)),2&e&&i.\u0275\u0275property("ngIf",t.routeInfos.length>0)},directives:[r.NgIf,I.DwTabSetComponent,r.NgForOf,I.DwTabComponent,g.DwIconElementComponent,S.DwProgramTitleComponent,v.DwIconDirective,o.RouterOutlet,m.DwBaseIframeComponent],pipes:[b.TranslatePipe],styles:[".error[_ngcontent-%COMP%]{color:red}.tab-close[_ngcontent-%COMP%]{margin-left:8px;margin-right:0}.closeall[_ngcontent-%COMP%]{cursor:pointer;content:url(/assets/dw-framework/img/closeall.svg);width:14px}"]}),e})(),j=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=i.\u0275\u0275defineInjector({imports:[[r.CommonModule,o.RouterModule,I.DwTabsModule,v.DwIconModule,h.FormsModule,g.DwIconElementModule,S.DwProgramTitleModule,h.ReactiveFormsModule,m.DwBaseIframeModule,b.TranslateModule]]}),e})()}}]);